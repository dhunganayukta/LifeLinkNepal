{% extends 'base.html' %}
{% load static %}

{% block title %}Donor Dashboard — LifeLink Nepal{% endblock %}

{% block extra_css %}
<style>
/* ═══════════════════════════════════════════════════════════
   DONOR DASHBOARD — matches base.html + home.html design
   Palette : ivory + crimson + gold + ink
   Type    : Cormorant Garamond display · Jost body
   ═══════════════════════════════════════════════════════════ */

/* ── PAGE WRAPPER ─────────────────────────────────────────── */
.dash-wrap {
    background: var(--ivory);
    min-height: 100vh;
    padding: 48px 0 80px;
}

/* ── HERO BANNER ──────────────────────────────────────────── */
.dash-hero {
    background: var(--ink);
    border-radius: 16px;
    padding: 36px 40px;
    margin-bottom: 40px;
    position: relative;
    overflow: hidden;
}

.dash-hero::before {
    content: '';
    position: absolute;
    top: -80px; right: -80px;
    width: 280px; height: 280px;
    border-radius: 50%;
    border: 1px solid rgba(196,146,74,0.12);
    pointer-events: none;
}

.dash-hero::after {
    content: '';
    position: absolute;
    top: -40px; right: -40px;
    width: 180px; height: 180px;
    border-radius: 50%;
    border: 1px solid rgba(196,146,74,0.07);
    pointer-events: none;
}

.dash-hero-crimson-bar {
    position: absolute;
    top: 0; left: 0;
    width: 4px; height: 100%;
    background: linear-gradient(180deg, var(--crimson) 0%, var(--gold) 100%);
    border-radius: 4px 0 0 4px;
}

.dash-hero-eyebrow {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
}

.dash-hero-eyebrow span {
    font-size: 10.5px;
    letter-spacing: 3px;
    text-transform: uppercase;
    font-weight: 600;
    color: var(--gold);
}

.dash-hero-eyebrow-line {
    width: 20px; height: 1px;
    background: var(--gold);
    opacity: 0.6;
}

.dash-hero h2 {
    font-family: var(--font-display);
    font-size: clamp(28px, 3.5vw, 44px);
    font-weight: 600;
    color: white;
    letter-spacing: -0.3px;
    line-height: 1.15;
    margin-bottom: 8px;
}

.dash-hero h2 em { font-style: italic; color: var(--crimson-light); }

.dash-hero p {
    font-size: 14.5px;
    color: rgba(240,232,222,0.6);
    margin: 0;
    line-height: 1.7;
}

.dash-hero-actions {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
}

.btn-dash-primary {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 10px 22px;
    background: white; color: var(--crimson);
    font-size: 13px; font-weight: 700;
    border-radius: 8px; text-decoration: none;
    transition: all 0.25s ease; border: 1.5px solid white;
}

.btn-dash-primary:hover {
    background: var(--ivory); color: var(--crimson-mid);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
}

.btn-dash-secondary {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 9px 20px;
    background: transparent; color: rgba(240,232,222,0.75);
    font-size: 13px; font-weight: 600;
    border-radius: 8px; text-decoration: none;
    transition: all 0.25s ease;
    border: 1.5px solid rgba(240,232,222,0.2);
}

.btn-dash-secondary:hover {
    border-color: rgba(196,146,74,0.5);
    color: var(--gold-light);
    background: rgba(196,146,74,0.08);
}

/* ── STAT CARDS ───────────────────────────────────────────── */
.stat-card {
    background: white;
    border: 1px solid var(--border-subtle);
    border-radius: 14px;
    padding: 24px;
    height: 100%;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

body.dark-mode .stat-card {
    background: #1a1410;
    border-color: rgba(255,255,255,0.06);
}

.stat-card::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--crimson), var(--gold));
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.35s ease;
}

.stat-card:hover::after { transform: scaleX(1); }

.stat-card:hover {
    transform: translateY(-6px);
    box-shadow: var(--shadow-lift);
    border-color: var(--border);
}

.stat-icon {
    width: 52px; height: 52px;
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    margin-bottom: 16px;
    transition: all 0.3s ease;
}

.stat-icon.crimson { background: var(--crimson-pale); color: var(--crimson); border: 1px solid var(--border); }
.stat-icon.gold    { background: var(--gold-pale);    color: var(--gold);    border: 1px solid rgba(196,146,74,0.2); }
.stat-icon.green   { background: rgba(74,222,128,0.1); color: #16a34a;       border: 1px solid rgba(74,222,128,0.2); }
.stat-icon.ink     { background: rgba(28,20,16,0.06);  color: var(--ink-mid); border: 1px solid var(--border-subtle); }

.stat-card:hover .stat-icon.crimson { background: var(--crimson); color: white; }
.stat-card:hover .stat-icon.gold    { background: var(--gold);    color: white; }
.stat-card:hover .stat-icon.green   { background: #16a34a;        color: white; }
.stat-card:hover .stat-icon.ink     { background: var(--ink-mid); color: white; }

.stat-number {
    font-family: var(--font-display);
    font-size: 38px; font-weight: 700;
    color: var(--ink); line-height: 1;
    letter-spacing: -0.5px;
    margin-bottom: 4px;
}

body.dark-mode .stat-number { color: var(--ink); }

.stat-label {
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--ink-muted);
    font-weight: 600;
}

/* ── ELIGIBILITY ALERT ────────────────────────────────────── */
.eligibility-bar {
    border-radius: 12px;
    padding: 18px 24px;
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 32px;
    border: 1px solid;
}

.eligibility-bar.eligible {
    background: rgba(74,222,128,0.07);
    border-color: rgba(74,222,128,0.25);
}

.eligibility-bar.ineligible {
    background: rgba(196,146,74,0.07);
    border-color: rgba(196,146,74,0.25);
}

.eligibility-bar-icon {
    width: 44px; height: 44px;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
}

.eligible .eligibility-bar-icon   { background: rgba(74,222,128,0.15); color: #16a34a; }
.ineligible .eligibility-bar-icon { background: var(--gold-pale);       color: var(--gold); }

.eligibility-bar-text strong {
    font-size: 14px;
    font-weight: 700;
    color: var(--ink);
    display: block;
    margin-bottom: 2px;
}

body.dark-mode .eligibility-bar-text strong { color: var(--ink); }

.eligibility-bar-text small {
    font-size: 13px;
    color: var(--ink-light);
}

/* ── SECTION CARDS ────────────────────────────────────────── */
.dash-card {
    background: white;
    border: 1px solid var(--border-subtle);
    border-radius: 14px;
    overflow: hidden;
    margin-bottom: 24px;
}

body.dark-mode .dash-card {
    background: #1a1410;
    border-color: rgba(255,255,255,0.06);
}

.dash-card-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--border-subtle);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--ivory-mid);
}

body.dark-mode .dash-card-header {
    background: #221c17;
    border-color: rgba(255,255,255,0.05);
}

.dash-card-title {
    font-family: var(--font-display);
    font-size: 19px;
    font-weight: 600;
    color: var(--ink);
    display: flex;
    align-items: center;
    gap: 10px;
}

body.dark-mode .dash-card-title { color: var(--ink); }

.dash-card-title i { color: var(--crimson); font-size: 16px; }

.dash-card-count {
    display: inline-flex; align-items: center; justify-content: center;
    min-width: 26px; height: 26px;
    padding: 0 8px;
    background: var(--crimson-pale);
    border: 1px solid var(--border);
    border-radius: 20px;
    font-size: 12px; font-weight: 700;
    color: var(--crimson);
}

.dash-card-body { padding: 20px 24px; }

/* ── NOTIFICATION ITEMS ───────────────────────────────────── */
.notif-item {
    border: 1px solid var(--border-subtle);
    border-radius: 12px;
    padding: 18px 20px;
    margin-bottom: 12px;
    background: white;
    transition: all 0.25s ease;
    position: relative;
    overflow: hidden;
}

body.dark-mode .notif-item {
    background: #221c17;
    border-color: rgba(255,255,255,0.06);
}

.notif-item.unread {
    border-left: 3px solid var(--crimson);
    background: linear-gradient(90deg, rgba(155,23,40,0.03) 0%, white 40%);
}

body.dark-mode .notif-item.unread {
    background: linear-gradient(90deg, rgba(155,23,40,0.08) 0%, #221c17 40%);
}

.notif-item:hover {
    border-color: var(--border);
    transform: translateX(4px);
    box-shadow: var(--shadow-warm);
}

.notif-item:last-child { margin-bottom: 0; }

/* Priority dot */
.priority-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
    margin-top: 3px;
}

.priority-dot.critical { background: var(--crimson); box-shadow: 0 0 0 3px rgba(155,23,40,0.15); animation: pulse-dot 1.6s infinite; }
.priority-dot.high     { background: var(--gold);    box-shadow: 0 0 0 3px rgba(196,146,74,0.15); }
.priority-dot.medium   { background: #3b82f6; }
.priority-dot.low      { background: var(--ink-muted); }

@keyframes pulse-dot {
    0%, 100% { box-shadow: 0 0 0 3px rgba(155,23,40,0.15); }
    50%       { box-shadow: 0 0 0 6px rgba(155,23,40,0); }
}

/* Tags / Badges */
.tag {
    display: inline-flex; align-items: center; gap: 4px;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 11.5px; font-weight: 700;
    letter-spacing: 0.3px;
}

.tag-crimson { background: var(--crimson-pale); color: var(--crimson); border: 1px solid var(--border); }
.tag-gold    { background: var(--gold-pale);    color: var(--gold);    border: 1px solid rgba(196,146,74,0.25); }
.tag-ink     { background: rgba(28,20,16,0.06); color: var(--ink-mid); border: 1px solid var(--border-subtle); }
.tag-green   { background: rgba(74,222,128,0.1); color: #16a34a;       border: 1px solid rgba(74,222,128,0.25); }

/* Action buttons inside notifs */
.btn-notif-view {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 7px 14px;
    background: transparent;
    color: var(--ink-mid);
    font-size: 12.5px; font-weight: 600;
    border-radius: 7px;
    text-decoration: none;
    transition: all 0.2s ease;
    border: 1.5px solid var(--border-subtle);
}

.btn-notif-view:hover {
    border-color: var(--crimson);
    color: var(--crimson);
    background: var(--crimson-pale);
}

.btn-notif-accept {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 7px 14px;
    background: #16a34a; color: white;
    font-size: 12.5px; font-weight: 600;
    border-radius: 7px; border: none; cursor: pointer;
    transition: all 0.2s ease;
}

.btn-notif-accept:hover {
    background: #15803d;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(22,163,74,0.3);
}

.btn-notif-reject {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 7px 14px;
    background: var(--crimson-pale); color: var(--crimson);
    font-size: 12.5px; font-weight: 600;
    border-radius: 7px;
    border: 1.5px solid var(--border);
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-notif-reject:hover {
    background: var(--crimson); color: white;
    border-color: var(--crimson);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(155,23,40,0.3);
}

/* ── EMPTY STATE ──────────────────────────────────────────── */
.empty-state {
    text-align: center;
    padding: 48px 24px;
}

.empty-state-icon {
    width: 72px; height: 72px;
    border-radius: 50%;
    background: var(--ivory-mid);
    border: 1px solid var(--border-subtle);
    display: flex; align-items: center; justify-content: center;
    margin: 0 auto 20px;
    font-size: 28px;
    color: var(--ink-muted);
}

.empty-state h6 {
    font-family: var(--font-display);
    font-size: 18px; font-weight: 600;
    color: var(--ink); margin-bottom: 6px;
}

.empty-state p {
    font-size: 13.5px; color: var(--ink-muted); margin: 0;
}

/* ── PROFILE CARD (right sidebar) ─────────────────────────── */
.blood-type-badge {
    width: 96px; height: 96px;
    border-radius: 50%;
    background: var(--crimson);
    display: inline-flex; align-items: center; justify-content: center;
    font-family: var(--font-display);
    font-size: 30px; font-weight: 700;
    color: white;
    margin: 0 auto 20px;
    box-shadow: 0 8px 24px rgba(155,23,40,0.35);
    transition: transform 0.3s ease;
}

.blood-type-badge:hover { transform: scale(1.07); }

.profile-table td {
    padding: 8px 0;
    font-size: 13.5px;
    border: none;
    vertical-align: middle;
}

.profile-table td:first-child {
    color: var(--ink-muted);
    font-weight: 500;
    width: 90px;
    padding-right: 12px;
}

.profile-table td:last-child {
    color: var(--ink);
    font-weight: 600;
}

body.dark-mode .profile-table td:last-child { color: var(--ink); }

/* ── LEADERBOARD CARD ─────────────────────────────────────── */
.leaderboard-card {
    background: var(--ink);
    border-radius: 14px;
    padding: 28px 24px;
    text-align: center;
    margin-bottom: 24px;
    position: relative;
    overflow: hidden;
}

.leaderboard-card::before {
    content: '';
    position: absolute;
    top: -50px; right: -50px;
    width: 140px; height: 140px;
    border-radius: 50%;
    border: 1px solid rgba(196,146,74,0.12);
    pointer-events: none;
}

.trophy-wrap {
    font-size: 42px;
    margin-bottom: 10px;
    animation: trophy-bounce 2.5s ease-in-out infinite;
}

@keyframes trophy-bounce {
    0%, 100% { transform: translateY(0); }
    50%       { transform: translateY(-8px); }
}

.leaderboard-card h5 {
    font-family: var(--font-display);
    font-size: 13px; font-weight: 600;
    color: var(--gold); letter-spacing: 2px;
    text-transform: uppercase; margin-bottom: 6px;
}

.leaderboard-card h4 {
    font-family: var(--font-display);
    font-size: 22px; font-weight: 600;
    color: white; margin-bottom: 8px;
}

/* ── DONATION TIMELINE ────────────────────────────────────── */
.timeline-item {
    position: relative;
    padding-left: 24px;
    padding-bottom: 18px;
}

.timeline-item::before {
    content: '';
    position: absolute;
    left: 4px; top: 6px;
    width: 10px; height: 10px;
    border-radius: 50%;
    background: var(--crimson);
    box-shadow: 0 0 0 3px rgba(155,23,40,0.15);
}

.timeline-item::after {
    content: '';
    position: absolute;
    left: 8px; top: 18px;
    width: 1px;
    bottom: 0;
    background: var(--border-subtle);
}

.timeline-item:last-child::after { display: none; }

.timeline-item:last-child { padding-bottom: 0; }

.timeline-date {
    font-size: 13px; font-weight: 700;
    color: var(--ink); margin-bottom: 2px;
}

body.dark-mode .timeline-date { color: var(--ink); }

.timeline-sub {
    font-size: 12px; color: var(--ink-muted); line-height: 1.5;
}

/* ── QUICK ACTIONS ────────────────────────────────────────── */
.quick-action-btn {
    display: flex; align-items: center; gap: 12px;
    padding: 14px 18px;
    background: white;
    border: 1px solid var(--border-subtle);
    border-radius: 10px;
    text-decoration: none;
    color: var(--ink-mid);
    font-size: 13.5px; font-weight: 600;
    transition: all 0.25s ease;
    width: 100%;
}

body.dark-mode .quick-action-btn {
    background: #221c17;
    border-color: rgba(255,255,255,0.06);
    color: var(--ink-mid);
}

.quick-action-btn i {
    width: 34px; height: 34px;
    border-radius: 8px;
    background: var(--crimson-pale);
    color: var(--crimson);
    display: flex; align-items: center; justify-content: center;
    font-size: 15px;
    transition: all 0.25s ease;
    flex-shrink: 0;
}

.quick-action-btn:hover {
    border-color: var(--crimson);
    color: var(--crimson);
    background: var(--crimson-pale);
    transform: translateX(4px);
    box-shadow: var(--shadow-warm);
}

.quick-action-btn:hover i {
    background: var(--crimson);
    color: white;
}

/* ── STATUS TOGGLE ────────────────────────────────────────── */
.availability-toggle {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px; font-weight: 700;
    letter-spacing: 0.5px; text-transform: uppercase;
    border: none; cursor: pointer;
    transition: all 0.25s ease;
}

.availability-toggle.available {
    background: rgba(74,222,128,0.12);
    color: #16a34a;
    border: 1.5px solid rgba(74,222,128,0.3);
}

.availability-toggle.unavailable {
    background: var(--gold-pale);
    color: var(--gold);
    border: 1.5px solid rgba(196,146,74,0.3);
}

.availability-toggle:hover { opacity: 0.8; transform: scale(0.97); }

/* ── SECTION DIVIDER ──────────────────────────────────────── */
.section-rule {
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--border-subtle) 30%, var(--border-subtle) 70%, transparent);
    margin: 32px 0;
}

/* ── DARK MODE ────────────────────────────────────────────── */
body.dark-mode .dash-wrap     { background: var(--ivory); }
body.dark-mode .notif-item    { color: var(--ink); }
body.dark-mode .eligibility-bar { border-color: rgba(255,255,255,0.08); }

/* ══════════════════════════════════════════════════════════
   NEW FEATURE STYLES (added — nothing above changed)
   ══════════════════════════════════════════════════════════ */

/* ── PAST NOTIFICATION EXPANDABLE ────────────────────────── */
.past-notif-row {
    cursor: pointer;
    user-select: none;
}

.past-notif-row:hover {
    border-color: var(--border) !important;
}

.past-notif-toggle-icon {
    transition: transform 0.25s ease;
    color: var(--ink-muted);
    font-size: 13px;
}

.past-notif-toggle-icon.open {
    transform: rotate(180deg);
}

.past-notif-detail {
    display: none;
    margin-top: 14px;
    padding-top: 14px;
    border-top: 1px solid var(--border-subtle);
}

.past-notif-detail.show {
    display: block;
}

.past-notif-detail-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px 20px;
}

.past-notif-detail-item label {
    display: block;
    font-size: 10.5px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    font-weight: 700;
    color: var(--ink-muted);
    margin-bottom: 3px;
}

.past-notif-detail-item span {
    font-size: 13.5px;
    font-weight: 600;
    color: var(--ink);
}

body.dark-mode .past-notif-detail-item span { color: var(--ink); }

/* ── FULFILL BUTTON ───────────────────────────────────────── */
.btn-notif-fulfill {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 7px 16px;
    background: linear-gradient(135deg, var(--crimson), #c0392b);
    color: white;
    font-size: 12.5px; font-weight: 700;
    border-radius: 7px; border: none; cursor: pointer;
    transition: all 0.2s ease;
    letter-spacing: 0.3px;
}

.btn-notif-fulfill:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(155,23,40,0.4);
    background: linear-gradient(135deg, #a91b2c, var(--crimson));
}

/* ── NEARBY HOSPITALS TABLE ───────────────────────────────── */
.hospital-table-wrap {
    overflow-x: auto;
}

.hospital-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 8px;
    font-size: 13.5px;
}

.hospital-table thead th {
    font-size: 10.5px;
    letter-spacing: 2px;
    text-transform: uppercase;
    font-weight: 700;
    color: var(--ink-muted);
    padding: 0 14px 8px;
    border-bottom: 1px solid var(--border-subtle);
    white-space: nowrap;
}

.hospital-table tbody tr {
    background: white;
    transition: all 0.2s ease;
}

body.dark-mode .hospital-table tbody tr {
    background: #221c17;
}

.hospital-table tbody tr:hover {
    transform: translateX(4px);
    box-shadow: var(--shadow-warm);
}

.hospital-table tbody td {
    padding: 14px;
    border-top: 1px solid var(--border-subtle);
    border-bottom: 1px solid var(--border-subtle);
    vertical-align: middle;
    color: var(--ink);
}

body.dark-mode .hospital-table tbody td { color: var(--ink); }

.hospital-table tbody td:first-child {
    border-left: 1px solid var(--border-subtle);
    border-radius: 10px 0 0 10px;
    padding-left: 18px;
}

.hospital-table tbody td:last-child {
    border-right: 1px solid var(--border-subtle);
    border-radius: 0 10px 10px 0;
    padding-right: 18px;
}

.hospital-name-cell {
    font-weight: 700;
    color: var(--ink);
}

.hospital-name-cell small {
    display: block;
    font-size: 11.5px;
    color: var(--ink-muted);
    font-weight: 500;
    margin-top: 2px;
}

.urgency-badge {
    display: inline-flex; align-items: center; gap: 4px;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 11px; font-weight: 700;
    letter-spacing: 0.5px;
}

.urgency-critical { background: rgba(155,23,40,0.1); color: var(--crimson); border: 1px solid rgba(155,23,40,0.2); }
.urgency-high     { background: var(--gold-pale);    color: #b45309;         border: 1px solid rgba(196,146,74,0.25); }
.urgency-medium   { background: rgba(59,130,246,0.1); color: #1d4ed8;        border: 1px solid rgba(59,130,246,0.2); }
.urgency-low      { background: rgba(28,20,16,0.06);  color: var(--ink-mid); border: 1px solid var(--border-subtle); }

.distance-pill {
    display: inline-flex; align-items: center; gap: 4px;
    font-size: 12px; font-weight: 600;
    color: var(--ink-mid);
}

/* ── DONATION HISTORY TABLE ───────────────────────────────── */
.history-table-wrap {
    overflow-x: auto;
}

.history-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 6px;
    font-size: 13.5px;
}

.history-table thead th {
    font-size: 10.5px;
    letter-spacing: 2px;
    text-transform: uppercase;
    font-weight: 700;
    color: var(--ink-muted);
    padding: 0 14px 10px;
    border-bottom: 1px solid var(--border-subtle);
    white-space: nowrap;
}

.history-table tbody tr {
    background: white;
    transition: all 0.2s ease;
}

body.dark-mode .history-table tbody tr {
    background: #221c17;
}

.history-table tbody tr:hover {
    transform: translateX(4px);
    box-shadow: var(--shadow-warm);
}

.history-table tbody td {
    padding: 13px 14px;
    border-top: 1px solid var(--border-subtle);
    border-bottom: 1px solid var(--border-subtle);
    vertical-align: middle;
    color: var(--ink);
}

body.dark-mode .history-table tbody td { color: var(--ink); }

.history-table tbody td:first-child {
    border-left: 1px solid var(--border-subtle);
    border-radius: 10px 0 0 10px;
    padding-left: 18px;
}

.history-table tbody td:last-child {
    border-right: 1px solid var(--border-subtle);
    border-radius: 0 10px 10px 0;
    padding-right: 18px;
    text-align: right;
}

.points-badge {
    display: inline-flex; align-items: center; gap: 4px;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 11.5px; font-weight: 700;
    background: var(--gold-pale);
    color: #92400e;
    border: 1px solid rgba(196,146,74,0.25);
}

/* ── TOAST NOTIFICATION ───────────────────────────────────── */
.ll-toast {
    position: fixed;
    bottom: 28px; right: 28px;
    z-index: 9999;
    background: var(--ink);
    color: white;
    border-radius: 12px;
    padding: 16px 22px;
    display: flex; align-items: center; gap: 14px;
    box-shadow: 0 12px 36px rgba(0,0,0,0.35);
    font-size: 13.5px; font-weight: 500;
    max-width: 360px;
    transform: translateY(80px);
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.34,1.56,0.64,1);
    pointer-events: none;
}

.ll-toast.show {
    transform: translateY(0);
    opacity: 1;
    pointer-events: auto;
}

.ll-toast-icon {
    width: 36px; height: 36px;
    border-radius: 8px;
    background: rgba(74,222,128,0.2);
    color: #4ade80;
    display: flex; align-items: center; justify-content: center;
    font-size: 17px;
    flex-shrink: 0;
}

.ll-toast strong {
    display: block;
    font-weight: 700;
    margin-bottom: 2px;
    font-size: 14px;
}

.ll-toast small {
    font-size: 12px;
    color: rgba(240,232,222,0.6);
}
</style>
{% endblock %}

{% block content %}
<div class="dash-wrap">
<div class="container">

    <!-- ── HERO ───────────────────────────────────────────── -->
    <div class="dash-hero">
        <div class="dash-hero-crimson-bar"></div>
        <div class="row align-items-center g-4">
            <div class="col-lg-8">
                <div class="dash-hero-eyebrow">
                    <div class="dash-hero-eyebrow-line"></div>
                    <span>Donor Dashboard</span>
                    <div class="dash-hero-eyebrow-line"></div>
                </div>
                <h2>Welcome back, <em>{{ donor.full_name }}</em></h2>
                <p>Your blood donation saves lives. Thank you for being a hero in someone's story.</p>
            </div>
            <div class="col-lg-4 d-flex justify-content-lg-end">
                <div class="dash-hero-actions">
                    <a href="{% url 'edit_profile' %}" class="btn-dash-primary">
                        <i class="bi bi-person-gear"></i> Edit Profile
                    </a>
                    <a href="{% url 'donation_history' %}" class="btn-dash-secondary">
                        <i class="bi bi-clock-history"></i> History
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- ── MESSAGES ───────────────────────────────────────── -->
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show mb-3"
             style="border:none; border-radius:10px; border-left:3px solid; font-size:13.5px;" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    {% endif %}

    <!-- ── STAT CARDS ─────────────────────────────────────── -->
    <div class="row g-3 mb-4">
        <div class="col-lg-3 col-md-6">
            <div class="stat-card">
                <div class="stat-icon crimson"><i class="bi bi-droplet-fill"></i></div>
                <div class="stat-number">{{ donor.donation_count }}</div>
                <div class="stat-label">Total Donations</div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="stat-card">
                <div class="stat-icon gold"><i class="bi bi-heart-pulse-fill"></i></div>
                <div class="stat-number">{{ total_units }}</div>
                <div class="stat-label">Units Donated</div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="stat-card">
                <div class="stat-icon green"><i class="bi bi-people-fill"></i></div>
                <div class="stat-number">{{ lives_saved }}</div>
                <div class="stat-label">Lives Saved</div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="stat-card">
                <div class="stat-icon ink"><i class="bi bi-activity"></i></div>
                <div style="margin-bottom:10px;">
                    {% if donor.is_available %}
                        <span class="tag tag-green"><i class="bi bi-check-circle-fill"></i> Available</span>
                    {% else %}
                        <span class="tag tag-gold"><i class="bi bi-pause-circle-fill"></i> Unavailable</span>
                    {% endif %}
                </div>
                <form method="post" action="{% url 'update_availability' %}">
                    {% csrf_token %}
                    <button type="submit" class="availability-toggle {% if donor.is_available %}available{% else %}unavailable{% endif %}">
                        <i class="bi bi-arrow-repeat"></i>
                        {% if donor.is_available %}Set Unavailable{% else %}Set Available{% endif %}
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- ── ELIGIBILITY BAR ────────────────────────────────── -->
    {% if not can_donate %}
    <div class="eligibility-bar ineligible">
        <div class="eligibility-bar-icon"><i class="bi bi-clock-history"></i></div>
        <div class="eligibility-bar-text">
            <strong>Not yet eligible to donate</strong>
            <small>You can donate again in <strong>{{ days_until_eligible }} days</strong> (90-day waiting period).
            {% if donor.last_donation_date %}Last donation: {{ donor.last_donation_date|date:"F d, Y" }}{% endif %}</small>
        </div>
    </div>
    {% else %}
    <div class="eligibility-bar eligible">
        <div class="eligibility-bar-icon"><i class="bi bi-check-circle-fill"></i></div>
        <div class="eligibility-bar-text">
            <strong>You're eligible to donate</strong>
            <small>Thank you for being available to save lives. Your generosity makes a real difference.</small>
        </div>
    </div>
    {% endif %}

    <!-- ── MAIN CONTENT ROW ───────────────────────────────── -->
    <div class="row g-4">

        <!-- LEFT: Notifications + Requests ──────────────── -->
        <div class="col-lg-8">

            <!-- Active Notifications -->
            <div class="dash-card">
                <div class="dash-card-header">
                    <div class="dash-card-title">
                        <i class="bi bi-bell-fill"></i>
                        Active Notifications
                    </div>
                    {% if active_notifications %}
                    <span class="dash-card-count">{{ active_notifications.count }}</span>
                    {% endif %}
                </div>
                <div class="dash-card-body">
                    {% if active_notifications %}
                        {% for notification in active_notifications %}
                        <div class="notif-item {% if not notification.is_read %}unread{% endif %}">
                            <div class="row align-items-start g-3">
                                <div class="col-md-7">
                                    <div class="d-flex gap-3">
                                        <div class="priority-dot mt-1
                                            {% if notification.blood_request.urgency_level == 'critical' %}critical
                                            {% elif notification.blood_request.urgency_level == 'high' %}high
                                            {% elif notification.blood_request.urgency_level == 'medium' %}medium
                                            {% else %}low{% endif %}">
                                        </div>
                                        <div>
                                            <div class="fw-bold mb-1" style="font-size:14px; color:var(--ink);">
                                                <i class="bi bi-hospital" style="color:var(--crimson);"></i>
                                                {{ notification.blood_request.hospital.hospital_name }}
                                            </div>
                                            <div class="d-flex flex-wrap gap-1 mb-2">
                                                <span class="tag tag-crimson">{{ notification.blood_request.blood_type }}</span>
                                                <span class="tag tag-gold">{{ notification.blood_request.units_needed }} units</span>
                                                {% if notification.distance %}
                                                <span class="tag tag-ink">
                                                    <i class="bi bi-geo-alt"></i> {{ notification.distance|floatformat:1 }} km
                                                </span>
                                                {% endif %}
                                            </div>
                                            <div style="font-size:12.5px; color:var(--ink-muted);">
                                                <strong style="color:var(--ink-light);">Patient:</strong>
                                                {{ notification.blood_request.patient_name }}
                                            </div>
                                            <div style="font-size:12px; color:var(--ink-muted); margin-top:4px;">
                                                <i class="bi bi-clock"></i>
                                                Notified {{ notification.notified_at|timesince }} ago
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="d-flex flex-column gap-2">
                                        <a href="{% url 'view_notification_detail' notification.id %}" class="btn-notif-view">
                                            <i class="bi bi-eye"></i> View Details
                                        </a>
                                        {% if notification.status == 'notified' %}
                                        <div class="d-flex gap-2">
                                            <form method="post" action="{% url 'accept_blood_request' notification.id %}" class="flex-fill">
                                                {% csrf_token %}
                                                <button type="submit" class="btn-notif-accept w-100"
                                                        onclick="return confirm('Accept this blood request?')">
                                                    <i class="bi bi-check-lg"></i> Accept
                                                </button>
                                            </form>
                                            <form method="post" action="{% url 'reject_blood_request' notification.id %}" class="flex-fill">
                                                {% csrf_token %}
                                                <button type="submit" class="btn-notif-reject w-100"
                                                        onclick="return confirm('Reject this request?')">
                                                    <i class="bi bi-x-lg"></i> Reject
                                                </button>
                                            </form>
                                        </div>
                                        {% elif notification.status == 'accepted' %}
                                        <!-- NEW: Fulfill button for accepted notifications -->
                                        <form method="post" action="{% url 'fulfill_blood_request' notification.id %}">
                                            {% csrf_token %}
                                            <button type="submit" class="btn-notif-fulfill w-100"
                                                    onclick="return confirm('Confirm that you have donated blood for this request? This will update your donation record and notify the admin.')"
                                                    data-fulfill>
                                                <i class="bi bi-droplet-fill"></i> Mark as Donated
                                            </button>
                                        </form>
                                        {% else %}
                                        <span class="tag tag-ink">{{ notification.status|title }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                    <div class="empty-state">
                        <div class="empty-state-icon"><i class="bi bi-inbox"></i></div>
                        <h6>No Active Notifications</h6>
                        <p>You'll be alerted when hospitals need your blood type.</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Nearby Blood Requests -->
            <div class="dash-card">
                <div class="dash-card-header">
                    <div class="dash-card-title">
                        <i class="bi bi-list-check"></i>
                        Available Requests Near You
                    </div>
                </div>
                <div class="dash-card-body">
                    {% if ranked_requests %}
                        {% for item in ranked_requests %}
                        <div class="notif-item">
                            <div class="d-flex justify-content-between align-items-start gap-3">
                                <div>
                                    <div class="fw-bold mb-1" style="font-size:14px; color:var(--ink);">
                                        <i class="bi bi-hospital" style="color:var(--crimson);"></i>
                                        {{ item.hospital_name }}
                                    </div>
                                    <div class="d-flex flex-wrap gap-1 mb-2">
                                        <span class="tag tag-crimson">{{ item.request.blood_type }}</span>
                                        <span class="tag tag-gold">{{ item.request.units_needed }} units</span>
                                        {% if item.distance %}
                                        <span class="tag tag-ink">
                                            <i class="bi bi-geo-alt"></i> {{ item.distance }} km
                                        </span>
                                        {% endif %}
                                    </div>
                                    <div style="font-size:12.5px; color:var(--ink-muted);">
                                        <i class="bi bi-calendar-event"></i>
                                        Required by: {{ item.request.required_by|date:"M d, Y" }}
                                    </div>
                                </div>
                                <a href="{% url 'view_blood_request_detail' item.request.id %}" class="btn-notif-view flex-shrink-0">
                                    <i class="bi bi-eye"></i> View
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                    <div class="empty-state">
                        <div class="empty-state-icon"><i class="bi bi-check-circle"></i></div>
                        <h6>No Urgent Requests</h6>
                        <p>Check back later for opportunities to help.</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- ── NEW: Nearby Hospitals Section ─────────────── -->
            <div class="dash-card" id="nearby-hospitals-section">
                <div class="dash-card-header">
                    <div class="dash-card-title">
                        <i class="bi bi-hospital-fill"></i>
                        Find Nearby Hospitals
                    </div>
                    <a href="{% url 'find_nearby_hospitals' %}" class="btn-notif-view" style="white-space:nowrap;">
                        <i class="bi bi-arrow-up-right-square"></i> View All
                    </a>
                </div>
                <div class="dash-card-body">
                    {% if nearby_hospitals %}
                    <div class="hospital-table-wrap">
                        <table class="hospital-table">
                            <thead>
                                <tr>
                                    <th>Hospital</th>
                                    <th>Blood Needed</th>
                                    <th>Units</th>
                                    <th>Urgency</th>
                                    <th>Distance</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for h in nearby_hospitals %}
                                <tr>
                                    <td>
                                        <div class="hospital-name-cell">
                                            {{ h.hospital_name }}
                                            <small>{{ h.address }}</small>
                                        </div>
                                    </td>
                                    <td><span class="tag tag-crimson">{{ h.blood_type }}</span></td>
                                    <td><span class="tag tag-gold">{{ h.units_needed }} u</span></td>
                                    <td>
                                        <span class="urgency-badge urgency-{{ h.urgency_level }}">
                                            {{ h.urgency_level|title }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="distance-pill">
                                            <i class="bi bi-geo-alt-fill" style="color:var(--crimson);"></i>
                                            {{ h.distance|floatformat:1 }} km
                                        </span>
                                    </td>
                                    <td>
                                        <a href="{% url 'view_hospital_detail' h.hospital_id %}" class="btn-notif-view">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <div class="empty-state-icon"><i class="bi bi-geo-alt"></i></div>
                        <h6>No Nearby Hospitals Found</h6>
                        <p>Enable location access or update your address in your profile to see hospitals near you.</p>
                        <a href="{% url 'edit_profile' %}" class="btn-notif-view mt-3" style="display:inline-flex;">
                            <i class="bi bi-pencil-square"></i> Update Address
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- ── NEW: Donation History Section ─────────────── -->
            <div class="dash-card" id="donation-history-section">
                <div class="dash-card-header">
                    <div class="dash-card-title">
                        <i class="bi bi-table"></i>
                        Donation History
                    </div>
                    <a href="{% url 'donation_history' %}" class="btn-notif-view" style="white-space:nowrap;">
                        <i class="bi bi-arrow-up-right-square"></i> Full History
                    </a>
                </div>
                <div class="dash-card-body">
                    {% if history %}
                    <div class="history-table-wrap">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Hospital</th>
                                    <th>Blood Type</th>
                                    <th>Units</th>
                                    <th>Status</th>
                                    <th>Points</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for donation in history|slice:":8" %}
                                <tr>
                                    <td style="white-space:nowrap; font-weight:600;">
                                        {{ donation.date_donated|date:"M d, Y" }}
                                    </td>
                                    <td>{{ donation.hospital.hospital_name }}</td>
                                    <td><span class="tag tag-crimson">{{ donation.blood_type }}</span></td>
                                    <td><span class="tag tag-gold">{{ donation.units_donated }} u</span></td>
                                    <td>
                                        {% if donation.status == 'fulfilled' or donation.status == 'completed' %}
                                            <span class="tag tag-green"><i class="bi bi-check-circle-fill"></i> Completed</span>
                                        {% elif donation.status == 'pending' %}
                                            <span class="tag tag-gold"><i class="bi bi-hourglass-split"></i> Pending</span>
                                        {% else %}
                                            <span class="tag tag-ink">{{ donation.status|title }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="points-badge">
                                            <i class="bi bi-star-fill"></i>
                                            +{{ donation.points_earned|default:"50" }}
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% if history|length > 8 %}
                    <div class="text-center mt-3">
                        <a href="{% url 'donation_history' %}" class="btn-notif-view" style="display:inline-flex;">
                            <i class="bi bi-arrow-right-circle"></i> View All {{ history|length }} Donations
                        </a>
                    </div>
                    {% endif %}
                    {% else %}
                    <div class="empty-state">
                        <div class="empty-state-icon"><i class="bi bi-droplet"></i></div>
                        <h6>No Donations Yet</h6>
                        <p>Your donation history will appear here after your first donation.</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Past Notifications — with expandable detail -->
            {% if past_notifications %}
            <div class="dash-card">
                <div class="dash-card-header">
                    <div class="dash-card-title">
                        <i class="bi bi-archive"></i> Past Notifications
                    </div>
                    <span class="dash-card-count">{{ past_notifications|length }}</span>
                </div>
                <div class="dash-card-body">
                    {% for notification in past_notifications %}
                    <!-- NEW: clickable row that expands to show full details -->
                    <div class="notif-item past-notif-row" onclick="togglePastNotif(this)" style="cursor:pointer;">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="fw-bold" style="font-size:13.5px; color:var(--ink);">
                                    <i class="bi bi-hospital" style="color:var(--crimson); margin-right:4px;"></i>
                                    {{ notification.blood_request.hospital.hospital_name }}
                                </div>
                                <div style="font-size:12px; color:var(--ink-muted); margin-top:4px;">
                                    <i class="bi bi-calendar"></i> {{ notification.sent_at|date:"M d, Y" }}
                                    &nbsp;·&nbsp;
                                    <span class="tag tag-crimson" style="padding:1px 7px; font-size:10.5px;">
                                        {{ notification.blood_request.blood_type }}
                                    </span>
                                    &nbsp;{{ notification.blood_request.units_needed }} units
                                </div>
                            </div>
                            <div class="d-flex align-items-center gap-3">
                                {% if notification.status == 'accepted' or notification.status == 'fulfilled' %}
                                    <span class="tag tag-green"><i class="bi bi-check"></i> {{ notification.status|title }}</span>
                                {% elif notification.status == 'rejected' %}
                                    <span class="tag tag-crimson"><i class="bi bi-x"></i> Rejected</span>
                                {% elif notification.status == 'cancelled' %}
                                    <span class="tag tag-ink"><i class="bi bi-dash"></i> Cancelled</span>
                                {% endif %}
                                <i class="bi bi-chevron-down past-notif-toggle-icon"></i>
                            </div>
                        </div>

                        <!-- Expandable detail panel -->
                        <div class="past-notif-detail">
                            <div class="past-notif-detail-grid">
                                <div class="past-notif-detail-item">
                                    <label>Patient Name</label>
                                    <span>{{ notification.blood_request.patient_name }}</span>
                                </div>
                                <div class="past-notif-detail-item">
                                    <label>Blood Type</label>
                                    <span><span class="tag tag-crimson">{{ notification.blood_request.blood_type }}</span></span>
                                </div>
                                <div class="past-notif-detail-item">
                                    <label>Units Required</label>
                                    <span>{{ notification.blood_request.units_needed }} unit(s)</span>
                                </div>
                                {% if notification.blood_request.ward %}
                                <div class="past-notif-detail-item">
                                    <label>Ward / Dept.</label>
                                    <span>{{ notification.blood_request.ward }}</span>
                                </div>
                                {% endif %}
                                {% if notification.blood_request.contact_number %}
                                <div class="past-notif-detail-item">
                                    <label>Contact</label>
                                    <span>
                                        <a href="tel:{{ notification.blood_request.contact_number }}"
                                           style="color:var(--crimson); text-decoration:none;"
                                           onclick="event.stopPropagation();">
                                            <i class="bi bi-telephone-fill"></i>
                                            {{ notification.blood_request.contact_number }}
                                        </a>
                                    </span>
                                </div>
                                {% endif %}
                                <div class="past-notif-detail-item">
                                    <label>Required By</label>
                                    <span>{{ notification.blood_request.required_by|date:"M d, Y" }}</span>
                                </div>
                                <div class="past-notif-detail-item">
                                    <label>Your Response</label>
                                    <span>{{ notification.status|title }}</span>
                                </div>
                                <div class="past-notif-detail-item">
                                    <label>Notified At</label>
                                    <span>{{ notification.notified_at|date:"M d, Y H:i" }}</span>
                                </div>
                            </div>
                            <div class="mt-3" onclick="event.stopPropagation();">
                                <a href="{% url 'view_notification_detail' notification.id %}" class="btn-notif-view">
                                    <i class="bi bi-arrow-up-right-square"></i> Full Request Page
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

        </div>

        <!-- RIGHT: Profile + Leaderboard + Actions ──────── -->
        <div class="col-lg-4">

            <!-- Donor Profile -->
            <div class="dash-card">
                <div class="dash-card-header">
                    <div class="dash-card-title">
                        <i class="bi bi-person-circle"></i> Your Profile
                    </div>
                </div>
                <div class="dash-card-body text-center">
                    <div class="blood-type-badge">{{ donor.blood_type }}</div>
                    <h5 style="font-family:var(--font-display); font-size:20px; font-weight:600; color:var(--ink); margin-bottom:16px;">
                        {{ donor.full_name }}
                    </h5>
                    <table class="profile-table w-100 text-start mb-3">
                        <tr>
                            <td><i class="bi bi-person text-muted"></i> Age</td>
                            <td>{{ donor.age }} years</td>
                        </tr>
                        <tr>
                            <td><i class="bi bi-telephone text-muted"></i> Phone</td>
                            <td>{{ donor.phone }}</td>
                        </tr>
                        <tr>
                            <td><i class="bi bi-droplet text-muted"></i> Blood</td>
                            <td><span class="tag tag-crimson">{{ donor.blood_type }}</span></td>
                        </tr>
                        {% if donor.weight %}
                        <tr>
                            <td><i class="bi bi-speedometer text-muted"></i> Weight</td>
                            <td>{{ donor.weight }} kg</td>
                        </tr>
                        {% endif %}
                        <tr>
                            <td><i class="bi bi-geo-alt text-muted"></i> Location</td>
                            <td>{{ donor.address|truncatewords:3 }}</td>
                        </tr>
                    </table>
                    <a href="{% url 'edit_profile' %}" class="btn-dash-primary w-100 justify-content-center"
                       style="background:var(--crimson); color:white; border-color:var(--crimson);">
                        <i class="bi bi-pencil-square"></i> Edit Profile
                    </a>
                </div>
            </div>

            <!-- Leaderboard -->
            {% if leaderboard %}
            <div class="leaderboard-card">
                <div class="trophy-wrap">🏆</div>
                <h5>Top Donor</h5>
                <h4>{{ leaderboard.username }}</h4>
                <span class="tag tag-gold">{{ leaderboard.blood_type }}</span>
                {% if leaderboard.hospital_name %}
                <p style="font-size:12px; color:rgba(240,232,222,0.5); margin-top:8px; margin-bottom:0;">
                    Last donated at {{ leaderboard.hospital_name }}
                </p>
                {% endif %}
            </div>
            {% endif %}

            <!-- Recent Donations -->
            {% if history %}
            <div class="dash-card">
                <div class="dash-card-header">
                    <div class="dash-card-title">
                        <i class="bi bi-clock-history"></i> Recent Donations
                    </div>
                </div>
                <div class="dash-card-body">
                    {% for donation in history|slice:":5" %}
                    <div class="timeline-item">
                        <div class="timeline-date">{{ donation.date_donated|date:"M d, Y" }}</div>
                        <div class="timeline-sub">
                            {{ donation.hospital.hospital_name }}<br>
                            <span class="tag tag-crimson" style="margin-top:4px;">
                                {{ donation.units_donated }} unit(s)
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                    <a href="{% url 'donation_history' %}" class="btn-notif-view w-100 justify-content-center mt-3">
                        <i class="bi bi-arrow-right-circle"></i> View Full History
                    </a>
                </div>
            </div>
            {% endif %}

            <!-- Quick Actions -->
            <div class="dash-card">
                <div class="dash-card-header">
                    <div class="dash-card-title">
                        <i class="bi bi-lightning-charge-fill"></i> Quick Actions
                    </div>
                </div>
                <div class="dash-card-body">
                    <div class="d-flex flex-column gap-2">
                        <a href="#nearby-hospitals-section" class="quick-action-btn" onclick="document.getElementById('nearby-hospitals-section').scrollIntoView({behavior:'smooth'}); return false;">
                            <i class="bi bi-geo-alt-fill"></i>
                            Find Nearby Hospitals
                        </a>
                        <a href="#donation-history-section" class="quick-action-btn" onclick="document.getElementById('donation-history-section').scrollIntoView({behavior:'smooth'}); return false;">
                            <i class="bi bi-clock-history"></i>
                            Donation History
                        </a>
                        {% if active_notifications %}
                        <form method="post" action="{% url 'mark_all_notifications_read' %}">
                            {% csrf_token %}
                            <button type="submit" class="quick-action-btn" style="background:none; text-align:left; cursor:pointer;">
                                <i class="bi bi-check-all"></i>
                                Mark All as Read
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </div>

        </div>
    </div>

</div>
</div>

<!-- ── TOAST NOTIFICATION (for fulfill action) ─────────────── -->
<div class="ll-toast" id="fulfillToast">
    <div class="ll-toast-icon"><i class="bi bi-check-circle-fill"></i></div>
    <div>
        <strong>Donation Recorded!</strong>
        <small>+50 points added · Admin has been notified</small>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Auto-dismiss success/info alerts
    setTimeout(() => {
        document.querySelectorAll('.alert-success, .alert-info').forEach(el => {
            new bootstrap.Alert(el).close();
        });
    }, 5000);

    // ── NEW: Toggle past notification detail panels ──────────
    function togglePastNotif(row) {
        const detail = row.querySelector('.past-notif-detail');
        const icon   = row.querySelector('.past-notif-toggle-icon');
        if (!detail) return;
        const isOpen = detail.classList.contains('show');
        // Close all others first
        document.querySelectorAll('.past-notif-detail.show').forEach(d => {
            d.classList.remove('show');
        });
        document.querySelectorAll('.past-notif-toggle-icon.open').forEach(i => {
            i.classList.remove('open');
        });
        // Toggle clicked one
        if (!isOpen) {
            detail.classList.add('show');
            icon.classList.add('open');
        }
    }

    // ── NEW: Toast on fulfill form submit ───────────────────
    document.querySelectorAll('[data-fulfill]').forEach(btn => {
        btn.closest('form').addEventListener('submit', function(e) {
            // Show toast after a tiny delay so page can process
            setTimeout(() => showFulfillToast(), 200);
        });
    });

    function showFulfillToast() {
        const toast = document.getElementById('fulfillToast');
        if (!toast) return;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 4500);
    }

    // Show toast if redirected back after fulfillment
    {% if messages %}
        {% for message in messages %}
            {% if 'fulfilled' in message.message|lower or 'donated' in message.message|lower %}
                document.addEventListener('DOMContentLoaded', () => showFulfillToast());
            {% endif %}
        {% endfor %}
    {% endif %}
</script>
{% endblock %}