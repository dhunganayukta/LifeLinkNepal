
{% load static %}

{% block title %}Super Admin Dashboard - Life Link Nepal{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;900&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">

<style>

/* Hide navbar and footer entirely on this page */
.navbar,
footer,
nav {
    display: none !important;
}

/* Hide any admin login/register buttons that may appear in base template */
.admin-login-btn,
.admin-register-btn,
.nav-auth,
.auth-buttons {
    display: none !important;
}

body {
    padding-top: 0 !important;
    margin-top: 0 !important;
}

:root {
    --navy-deepest: #04080f;
    --navy-deep: #080e1a;
    --navy-dark: #0d1525;
    --navy-mid: #121d32;
    --navy-light: #1a2844;
    --navy-muted: #233258;

    --gold: #c9a84c;
    --gold-light: #e8c97a;
    --gold-dim: #8a6f32;
    --gold-pale: rgba(201, 168, 76, 0.12);

    --red: #c23b3b;
    --red-bright: #e05252;
    --red-pale: rgba(194, 59, 59, 0.15);

    --emerald: #2a8c6e;
    --emerald-bright: #3db88f;
    --emerald-pale: rgba(42, 140, 110, 0.15);

    --amber: #b87333;
    --amber-pale: rgba(184, 115, 51, 0.15);

    --sky: #2a6bac;
    --sky-pale: rgba(42, 107, 172, 0.15);

    --text-primary: #e8e2d5;
    --text-secondary: #9ea9c0;
    --text-muted: #5a6882;
    --text-gold: #c9a84c;

    --border: rgba(201, 168, 76, 0.15);
    --border-dim: rgba(255, 255, 255, 0.06);
    --border-bright: rgba(201, 168, 76, 0.4);

    --shadow-gold: 0 0 40px rgba(201, 168, 76, 0.08);
    --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.4);

    --radius-sm: 4px;
    --radius-md: 8px;
    --radius-lg: 12px;

    --font-display: 'Playfair Display', Georgia, serif;
    --font-body: 'DM Sans', sans-serif;
    --font-mono: 'DM Mono', 'Courier New', monospace;
}

*, *::before, *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background: var(--navy-deepest);
    font-family: var(--font-body);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
    overflow-x: hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.admin-sidebar {
    position: fixed;
    left: 0;
    top: 0;
    width: 260px;
    height: 100vh;
    background: var(--navy-dark);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    z-index: 1000;
    overflow-y: auto;
    overflow-x: hidden;
}

.admin-sidebar::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 1px;
    height: 100%;
    background: linear-gradient(180deg, transparent, var(--gold-dim) 30%, var(--gold-dim) 70%, transparent);
    pointer-events: none;
}

.sidebar-header {
    padding: 24px 28px 22px;
    border-bottom: 1px solid var(--border);
    position: relative;
}

.sidebar-logo {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 8px;
}

.sidebar-logo-img {
    width: 42px;
    height: 42px;
    border-radius: var(--radius-md);
    object-fit: contain;
    background: white;
    padding: 4px;
    flex-shrink: 0;
    border: 1px solid rgba(194, 59, 59, 0.25);
}

.sidebar-header h3 {
    font-family: var(--font-display);
    font-size: 17px;
    font-weight: 700;
    color: var(--text-primary);
    letter-spacing: 0.3px;
    line-height: 1.2;
}

.sidebar-header h3 span { color: var(--gold); }

.sidebar-header p {
    font-size: 10px;
    color: var(--text-muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-top: 4px;
    font-weight: 600;
}

.sidebar-menu {
    padding: 20px 0;
    flex: 1;
}

.menu-section-label {
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-muted);
    padding: 12px 28px 8px;
    font-weight: 600;
}

.menu-item {
    display: flex;
    align-items: center;
    padding: 13px 28px;
    color: var(--text-secondary);
    text-decoration: none;
    transition: all 0.2s ease;
    cursor: pointer;
    font-size: 13.5px;
    font-weight: 500;
    gap: 14px;
    position: relative;
    margin: 1px 0;
}

.menu-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--gold);
    opacity: 0;
    transition: opacity 0.2s ease;
}

.menu-item:hover {
    color: var(--text-primary);
    background: rgba(255,255,255,0.03);
}

.menu-item:hover::before { opacity: 0.5; }

.menu-item.active {
    color: var(--gold-light);
    background: var(--gold-pale);
}

.menu-item.active::before { opacity: 1; }

.menu-item i {
    font-size: 15px;
    width: 18px;
    text-align: center;
    flex-shrink: 0;
    opacity: 0.8;
}

.menu-item span { flex: 1; letter-spacing: 0.1px; }

.menu-badge {
    background: var(--red);
    color: #fff;
    padding: 2px 8px;
    border-radius: 20px;
    font-size: 10px;
    font-weight: 700;
    font-family: var(--font-mono);
    letter-spacing: 0.5px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR FOOTER â€” minimal, no admin info
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar-footer {
    border-top: 1px solid var(--border);
    padding: 14px 28px;
    flex-shrink: 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOP HEADER BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.admin-topbar {
    position: sticky;
    top: 0;
    z-index: 100;
    background: var(--navy-dark);
    border-bottom: 1px solid var(--border-dim);
    padding: 0 40px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 16px;
}

.topbar-admin-pill {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 6px 14px 6px 8px;
    background: var(--gold-pale);
    border: 1px solid rgba(201, 168, 76, 0.2);
    border-radius: 40px;
}

.topbar-avatar {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: rgba(201, 168, 76, 0.2);
    border: 1px solid rgba(201, 168, 76, 0.35);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-display);
    font-size: 13px;
    font-weight: 700;
    color: var(--gold-light);
    flex-shrink: 0;
}

.topbar-admin-details {
    display: flex;
    flex-direction: column;
    line-height: 1.2;
}

.topbar-admin-details strong {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-primary);
    white-space: nowrap;
}

.topbar-admin-details span {
    font-size: 9.5px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--gold-dim);
    font-weight: 600;
}

.topbar-signout {
    display: inline-flex;
    align-items: center;
    gap: 7px;
    padding: 8px 16px;
    background: rgba(194, 59, 59, 0.08);
    border: 1px solid rgba(194, 59, 59, 0.25);
    border-radius: var(--radius-md);
    color: #d97070;
    text-decoration: none;
    font-size: 12.5px;
    font-weight: 600;
    font-family: var(--font-body);
    cursor: pointer;
    transition: all 0.2s ease;
    letter-spacing: 0.2px;
    white-space: nowrap;
}

.topbar-signout:hover {
    background: rgba(194, 59, 59, 0.18);
    border-color: rgba(194, 59, 59, 0.45);
    color: #e05252;
}

.topbar-signout i { font-size: 13px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN CONTENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.admin-main {
    margin-left: 260px;
    min-height: 100vh;
    background: var(--navy-deepest);
    display: flex;
    flex-direction: column;
}

.content-area { padding: 36px 40px; }

.page-header {
    margin-bottom: 36px;
    position: relative;
    padding-bottom: 24px;
}

.page-header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 60px;
    height: 1px;
    background: var(--gold);
}

.page-header-eyebrow {
    font-size: 11px;
    letter-spacing: 2.5px;
    text-transform: uppercase;
    color: var(--gold);
    font-weight: 600;
    margin-bottom: 8px;
}

.page-header h2 {
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: 700;
    color: var(--text-primary);
    letter-spacing: -0.3px;
    line-height: 1.2;
}

.page-header p {
    color: var(--text-muted);
    font-size: 14px;
    margin-top: 6px;
    font-weight: 400;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 36px;
}

.stat-card {
    background: var(--navy-dark);
    border: 1px solid var(--border-dim);
    border-radius: var(--radius-lg);
    padding: 24px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.25s ease, transform 0.25s ease;
    cursor: default;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    opacity: 0;
    transition: opacity 0.25s ease;
}

.stat-card:hover { border-color: var(--border); transform: translateY(-3px); }
.stat-card:hover::before { opacity: 1; }

.stat-card.donors::before   { background: var(--red); }
.stat-card.hospitals::before { background: var(--sky); }
.stat-card.requests::before  { background: var(--amber); }
.stat-card.completed::before { background: var(--emerald); }

.stat-ornament {
    position: absolute;
    top: 16px; right: 20px;
    font-size: 32px;
    opacity: 0.06;
    pointer-events: none;
    font-family: var(--font-display);
    font-weight: 900;
    color: #fff;
}

.stat-label {
    font-size: 10.5px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-muted);
    font-weight: 600;
    margin-bottom: 14px;
}

.stat-value {
    font-family: var(--font-display);
    font-size: 42px;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 12px;
    letter-spacing: -1px;
}

.stat-card.donors    .stat-value { color: #d97070; }
.stat-card.hospitals .stat-value { color: #6ea8d9; }
.stat-card.requests  .stat-value { color: #d4a056; }
.stat-card.completed .stat-value { color: #5cbfa0; }

.stat-meta {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: var(--text-muted);
    font-weight: 500;
}

.stat-dot {
    width: 5px; height: 5px;
    border-radius: 50%;
    background: var(--emerald-bright);
    animation: live-pulse 2s infinite;
}

@keyframes live-pulse {
    0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(224, 82, 82, 0.4); }
    50%       { opacity: 0.7; box-shadow: 0 0 0 4px rgba(224, 82, 82, 0); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTENT SECTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.content-section {
    background: var(--navy-dark);
    border: 1px solid var(--border-dim);
    border-radius: var(--radius-lg);
    padding: 28px;
    margin-bottom: 24px;
    position: relative;
}

.section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
    padding-bottom: 18px;
    border-bottom: 1px solid var(--border-dim);
}

.section-title { display: flex; flex-direction: column; gap: 3px; }

.section-eyebrow {
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gold-dim);
    font-weight: 600;
}

.section-header h3 {
    font-family: var(--font-display);
    font-size: 17px;
    font-weight: 600;
    color: var(--text-primary);
    letter-spacing: 0.2px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TERMINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.terminal-requests {
    background: #060b14;
    border: 1px solid rgba(201, 168, 76, 0.2);
    border-radius: var(--radius-lg);
    padding: 0;
    font-family: var(--font-mono);
    overflow: hidden;
    margin-bottom: 24px;
    max-height: 560px;
    overflow-y: auto;
}

.terminal-requests::-webkit-scrollbar { width: 4px; }
.terminal-requests::-webkit-scrollbar-track { background: transparent; }
.terminal-requests::-webkit-scrollbar-thumb { background: var(--navy-muted); border-radius: 2px; }

.terminal-topbar {
    background: #0a1120;
    border-bottom: 1px solid rgba(201, 168, 76, 0.15);
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 2;
}

.terminal-dots { display: flex; gap: 7px; }
.terminal-dot { width: 11px; height: 11px; border-radius: 50%; }
.terminal-dot.red   { background: #c23b3b; }
.terminal-dot.amber { background: #b87333; }
.terminal-dot.green { background: #2a8c6e; }

.terminal-topbar-title {
    font-size: 11px;
    color: rgba(201, 168, 76, 0.6);
    letter-spacing: 1.5px;
    text-transform: uppercase;
}

.terminal-time { font-size: 11px; color: rgba(201, 168, 76, 0.5); letter-spacing: 0.5px; }

.terminal-body { padding: 20px; }

.terminal-request {
    margin-bottom: 20px;
    padding: 16px 18px;
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.04);
    border-left: 3px solid rgba(194, 59, 59, 0.5);
    border-radius: var(--radius-sm);
}

.terminal-request.urgent {
    border-left-color: var(--red);
    background: rgba(194, 59, 59, 0.06);
    animation: terminal-alert 3s ease-in-out infinite;
}

@keyframes terminal-alert {
    0%, 100% { background: rgba(194, 59, 59, 0.04); }
    50%       { background: rgba(194, 59, 59, 0.09); }
}

.terminal-line { margin: 5px 0; line-height: 1.7; font-size: 12.5px; }
.terminal-label   { color: rgba(201, 168, 76, 0.75); font-weight: 500; }
.terminal-value   { color: rgba(232, 226, 213, 0.85); }
.terminal-urgent  { color: #e05252; font-weight: 600; }
.terminal-success { color: #3db88f; font-weight: 600; }

.matched-donors-section {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid rgba(201, 168, 76, 0.15);
}

.donor-match-item {
    margin: 8px 0;
    padding: 10px 12px;
    background: rgba(42, 107, 172, 0.08);
    border: 1px solid rgba(42, 107, 172, 0.15);
    border-radius: var(--radius-sm);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LEADERBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.leaderboard-card {
    background: var(--navy-dark);
    border: 1px solid var(--border-dim);
    border-radius: var(--radius-lg);
    padding: 28px;
    margin-bottom: 24px;
}

.leaderboard-item {
    display: flex;
    align-items: center;
    padding: 18px 20px;
    margin-bottom: 10px;
    background: rgba(255,255,255,0.02);
    border: 1px solid var(--border-dim);
    border-radius: var(--radius-md);
    transition: all 0.2s ease;
    gap: 16px;
}

.leaderboard-item:hover { background: rgba(255,255,255,0.04); border-color: var(--border); transform: translateX(4px); }
.leaderboard-item.rank-1 { background: rgba(201, 168, 76, 0.07); border-color: rgba(201, 168, 76, 0.2); }
.leaderboard-item.rank-2 { background: rgba(160, 160, 180, 0.05); border-color: rgba(160, 160, 180, 0.15); }
.leaderboard-item.rank-3 { background: rgba(184, 115, 51, 0.07); border-color: rgba(184, 115, 51, 0.2); }

.rank-badge {
    width: 44px; height: 44px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 18px;
    flex-shrink: 0;
}

.rank-badge.rank-1    { background: rgba(201, 168, 76, 0.15); border: 1px solid rgba(201, 168, 76, 0.3); color: var(--gold-light); }
.rank-badge.rank-2    { background: rgba(160, 160, 180, 0.12); border: 1px solid rgba(160, 160, 180, 0.25); color: #c0c0d0; }
.rank-badge.rank-3    { background: rgba(184, 115, 51, 0.15); border: 1px solid rgba(184, 115, 51, 0.3); color: #d4956a; }
.rank-badge.rank-other { background: rgba(255,255,255,0.04); border: 1px solid var(--border-dim); color: var(--text-muted); font-size: 14px; }

.donor-info-leaderboard { flex: 1; display: flex; align-items: center; gap: 14px; min-width: 0; }

.donor-avatar-leaderboard {
    width: 40px; height: 40px;
    border-radius: var(--radius-md);
    background: var(--red-pale);
    border: 1px solid rgba(194, 59, 59, 0.2);
    color: #d97070;
    display: flex; align-items: center; justify-content: center;
    font-family: var(--font-display);
    font-size: 16px; font-weight: 700;
    flex-shrink: 0;
}

.donor-details-leaderboard h4 { font-size: 14.5px; font-weight: 600; color: var(--text-primary); margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.donor-details-leaderboard p  { font-size: 12px; color: var(--text-muted); display: flex; align-items: center; gap: 6px; }

.donor-stars { display: flex; gap: 3px; margin-top: 5px; }
.star { color: var(--gold-dim); font-size: 12px; }
.leaderboard-item.rank-1 .star { color: var(--gold); }

.donation-count {
    background: var(--red-pale);
    border: 1px solid rgba(194, 59, 59, 0.2);
    color: #d97070;
    padding: 6px 14px;
    border-radius: 20px;
    font-family: var(--font-mono);
    font-weight: 600;
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 6px;
    flex-shrink: 0;
}

.donation-count i { font-size: 12px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA GRID / CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.data-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 16px;
    margin-top: 16px;
}

.data-card {
    background: rgba(255,255,255,0.02);
    border: 1px solid var(--border-dim);
    border-radius: var(--radius-lg);
    padding: 20px;
    transition: all 0.2s ease;
}

.data-card:hover { background: rgba(255,255,255,0.04); border-color: var(--border); transform: translateY(-2px); }

.data-card-header {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-bottom: 16px;
    padding-bottom: 14px;
    border-bottom: 1px solid var(--border-dim);
}

.data-avatar {
    width: 48px; height: 48px;
    border-radius: var(--radius-md);
    background: var(--red-pale);
    border: 1px solid rgba(194, 59, 59, 0.2);
    color: #d97070;
    display: flex; align-items: center; justify-content: center;
    font-family: var(--font-display);
    font-size: 20px; font-weight: 700;
    flex-shrink: 0;
}

.data-avatar.hospital { background: var(--sky-pale); border-color: rgba(42, 107, 172, 0.25); color: #6ea8d9; font-size: 18px; }

.data-info h4 { font-size: 15px; font-weight: 600; color: var(--text-primary); margin-bottom: 4px; }
.data-info p  { font-size: 12px; color: var(--text-muted); display: flex; align-items: center; gap: 6px; margin: 3px 0; }
.data-info p i { font-size: 11px; opacity: 0.7; width: 12px; }

.blood-type { padding: 3px 10px; border-radius: 4px; font-family: var(--font-mono); font-weight: 600; font-size: 12px; letter-spacing: 0.5px; }
.blood-type.positive { background: var(--red-pale); color: #d97070; border: 1px solid rgba(194, 59, 59, 0.2); }
.blood-type.negative { background: var(--sky-pale); color: #6ea8d9; border: 1px solid rgba(42, 107, 172, 0.2); }

.status-badge { padding: 3px 10px; border-radius: 4px; font-size: 10px; font-weight: 600; letter-spacing: 1.5px; text-transform: uppercase; display: inline-block; }
.status-badge.active, .status-badge.pending, .status-badge.matched    { background: var(--amber-pale); color: #d4a056; border: 1px solid rgba(184, 115, 51, 0.25); }
.status-badge.completed, .status-badge.accepted, .status-badge.fulfilled { background: var(--emerald-pale); color: #5cbfa0; border: 1px solid rgba(42, 140, 110, 0.25); }
.status-badge.cancelled, .status-badge.rejected { background: var(--red-pale); color: #d97070; border: 1px solid rgba(194, 59, 59, 0.2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REQUEST CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.request-card {
    background: rgba(255,255,255,0.02);
    border: 1px solid var(--border-dim);
    border-radius: var(--radius-lg);
    padding: 22px;
    margin-bottom: 14px;
    transition: all 0.2s ease;
}

.request-card:hover { background: rgba(255,255,255,0.04); border-color: var(--border); }
.request-card.critical { border-left: 3px solid var(--red); background: rgba(194, 59, 59, 0.04); }

.request-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
.request-id { font-family: var(--font-mono); font-size: 12px; color: var(--gold-dim); letter-spacing: 1px; font-weight: 500; }
.request-body { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 14px; margin-bottom: 16px; }
.request-label { font-size: 10px; letter-spacing: 2px; text-transform: uppercase; color: var(--text-muted); font-weight: 600; margin-bottom: 4px; }
.request-value { font-size: 13.5px; color: var(--text-primary); font-weight: 500; }

.donor-priority-list {
    background: rgba(255,255,255,0.02);
    border: 1px solid var(--border-dim);
    border-radius: var(--radius-md);
    padding: 16px;
    margin-top: 14px;
}

.donor-priority-list h5 {
    font-size: 11px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--gold-dim);
    font-weight: 600;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.donor-priority-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px;
    background: rgba(255,255,255,0.02);
    border: 1px solid var(--border-dim);
    border-radius: var(--radius-sm);
    margin-bottom: 6px;
    transition: all 0.2s ease;
}

.donor-priority-item:hover { background: rgba(255,255,255,0.04); border-color: var(--border); }
.donor-priority-info { display: flex; align-items: center; gap: 12px; flex: 1; }

.donor-priority-rank { width: 28px; height: 28px; border-radius: var(--radius-sm); background: var(--navy-muted); display: flex; align-items: center; justify-content: center; font-family: var(--font-mono); font-size: 12px; font-weight: 600; color: var(--text-muted); flex-shrink: 0; }
.donor-priority-rank.rank-1 { background: rgba(201, 168, 76, 0.15); color: var(--gold); border: 1px solid rgba(201, 168, 76, 0.25); }
.donor-priority-rank.rank-2 { background: rgba(160, 160, 180, 0.1); color: #a0a0b0; border: 1px solid rgba(160, 160, 180, 0.2); }
.donor-priority-rank.rank-3 { background: rgba(184, 115, 51, 0.12); color: #d4956a; border: 1px solid rgba(184, 115, 51, 0.25); }

.donor-priority-details p { margin: 0; font-size: 12.5px; color: var(--text-primary); font-weight: 500; }
.donor-priority-details p:last-child { font-size: 11.5px; color: var(--text-muted); margin-top: 2px; font-weight: 400; }

.priority-badge { display: inline-flex; align-items: center; gap: 5px; padding: 3px 10px; border-radius: 4px; font-size: 10px; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase; }
.priority-badge.priority-1     { background: rgba(201, 168, 76, 0.12); color: var(--gold); border: 1px solid rgba(201, 168, 76, 0.2); }
.priority-badge.priority-2     { background: rgba(160, 160, 180, 0.08); color: #a0a0b0; border: 1px solid rgba(160, 160, 180, 0.15); }
.priority-badge.priority-3     { background: rgba(184, 115, 51, 0.1); color: #d4956a; border: 1px solid rgba(184, 115, 51, 0.2); }
.priority-badge.priority-other { background: rgba(255,255,255,0.04); color: var(--text-muted); border: 1px solid var(--border-dim); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS / INPUTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn-action {
    padding: 8px 16px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    font-size: 12.5px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 7px;
    white-space: nowrap;
    background: transparent;
    color: var(--text-secondary);
    font-family: var(--font-body);
    letter-spacing: 0.3px;
}

.btn-action:hover { background: rgba(255,255,255,0.05); border-color: var(--border-bright); color: var(--gold-light); }

.search-bar { margin-bottom: 20px; }

.search-input {
    width: 100%;
    max-width: 440px;
    padding: 10px 16px 10px 40px;
    background: var(--navy-deepest);
    border: 1px solid var(--border-dim);
    border-radius: var(--radius-md);
    font-size: 13.5px;
    color: var(--text-primary);
    transition: all 0.2s ease;
    font-family: var(--font-body);
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' fill='%235a6882' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: 14px center;
}

.search-input::placeholder { color: var(--text-muted); }
.search-input:focus { outline: none; border-color: rgba(201, 168, 76, 0.35); box-shadow: 0 0 0 3px rgba(201, 168, 76, 0.06); background-color: var(--navy-deepest); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INFO TABLE / SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.info-table { width: 100%; border-collapse: collapse; }
.info-table tr { border-bottom: 1px solid var(--border-dim); }
.info-table tr:last-child { border-bottom: none; }
.info-table td { padding: 14px 4px; font-size: 13.5px; }
.info-table td:first-child { color: var(--text-muted); font-weight: 500; width: 45%; font-size: 12.5px; letter-spacing: 0.2px; }
.info-table td:last-child { color: var(--text-primary); font-weight: 600; }

.settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
.form-group { margin-bottom: 20px; }
.form-group label { display: block; font-size: 11px; letter-spacing: 1.5px; text-transform: uppercase; color: var(--text-muted); font-weight: 600; margin-bottom: 8px; }
.form-control { width: 100%; padding: 10px 14px; background: var(--navy-deepest); border: 1px solid var(--border-dim); border-radius: var(--radius-md); font-size: 13.5px; color: var(--text-secondary); font-family: var(--font-body); transition: border-color 0.2s ease; }
.form-control:focus { outline: none; border-color: rgba(201, 168, 76, 0.35); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOADING / EMPTY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.loading { text-align: center; padding: 60px 20px; }
.spinner { width: 36px; height: 36px; border: 2px solid var(--border-dim); border-top-color: var(--gold-dim); border-radius: 50%; animation: spin 0.9s linear infinite; margin: 0 auto 16px; }
@keyframes spin { to { transform: rotate(360deg); } }
.loading p { font-size: 13px; color: var(--text-muted); font-weight: 500; letter-spacing: 0.3px; }

.empty-state { text-align: center; padding: 70px 20px; color: var(--text-muted); }
.empty-state i { font-size: 56px; opacity: 0.2; margin-bottom: 20px; display: block; }
.empty-state h4 { font-family: var(--font-display); font-size: 18px; margin-bottom: 8px; font-weight: 600; color: var(--text-secondary); }
.empty-state p { font-size: 13px; color: var(--text-muted); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLLBARS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--navy-muted); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--navy-light); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 768px) {
    .admin-sidebar { transform: translateX(-100%); transition: transform 0.25s ease; }
    .admin-sidebar.mobile-open { transform: translateX(0); }
    .admin-main { margin-left: 0; }
    .admin-topbar { padding: 0 20px; }
    .stats-grid { grid-template-columns: 1fr 1fr; }
    .content-area { padding: 20px; }
    .data-grid { grid-template-columns: 1fr; }
    .topbar-admin-pill { display: none; }
}
@media (max-width: 480px) { .stats-grid { grid-template-columns: 1fr; } }
</style>
{% endblock %}

{% block content %}

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="admin-sidebar" id="adminSidebar">

    <!-- Logo / Title -->
    <div class="sidebar-header">
        <div class="sidebar-logo">
            <img src="{% static 'images/logo.jpeg' %}" alt="LifeLink Nepal" class="sidebar-logo-img">
            <div>
                <h3>Life<span>Link</span> Nepal</h3>
            </div>
        </div>
        <p>Super Admin Console</p>
    </div>

    <!-- Navigation -->
    <div class="sidebar-menu">
        <div class="menu-section-label">Overview</div>
        <a href="#dashboard" class="menu-item active" data-section="dashboard">
            <i class="bi bi-speedometer2"></i>
            <span>Live Dashboard</span>
        </a>
        <a href="#requests" class="menu-item" data-section="requests">
            <i class="bi bi-bell"></i>
            <span>Blood Requests</span>
            <span class="menu-badge" id="requestCount">0</span>
        </a>

        <div class="menu-section-label" style="margin-top: 8px;">Directory</div>
        <a href="#leaderboard" class="menu-item" data-section="leaderboard">
            <i class="bi bi-trophy"></i>
            <span>Top Donors</span>
        </a>
        <a href="#donors" class="menu-item" data-section="donors">
            <i class="bi bi-heart-pulse"></i>
            <span>All Donors</span>
        </a>
        <a href="#hospitals" class="menu-item" data-section="hospitals">
            <i class="bi bi-hospital"></i>
            <span>All Hospitals</span>
        </a>

        <div class="menu-section-label" style="margin-top: 8px;">System</div>
        <a href="#analytics" class="menu-item" data-section="analytics">
            <i class="bi bi-bar-chart"></i>
            <span>Analytics</span>
        </a>
        <a href="#settings" class="menu-item" data-section="settings">
            <i class="bi bi-gear"></i>
            <span>Settings</span>
        </a>
    </div>

    <!-- Footer: minimal system label -->
    <div class="sidebar-footer">
        <div style="font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:var(--text-muted);font-weight:600;text-align:center;">
            LifeLink Nepal &mdash; v1.0 Beta
        </div>
    </div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN CONTENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="admin-main">

    <!-- Top Header Bar -->
    <div class="admin-topbar">
        <div class="topbar-admin-pill">
            <div class="topbar-avatar">{{ user.username|first|upper|default:"A" }}</div>
            <div class="topbar-admin-details">
                <strong>{{ user.username|default:"Admin" }}</strong>
                <span>Super Admin</span>
            </div>
        </div>
        <a href="{% url 'accounts:login_page' %}" class="topbar-signout">
            <i class="bi bi-box-arrow-right"></i>
            Sign Out
        </a>
    </div>

    <div class="content-area" id="mainContent">

        <!-- â”€â”€ Dashboard Section â”€â”€ -->
        <div id="dashboardSection" class="content-section-wrapper">
            <div class="page-header">
                <div class="page-header-eyebrow">Overview</div>
                <h2>Live Dashboard</h2>
                <p>Real-time blood donation activity monitoring</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card donors">
                    <div class="stat-ornament">â™¥</div>
                    <div class="stat-label">Registered Donors</div>
                    <div class="stat-value" id="totalDonors">0</div>
                    <div class="stat-meta"><div class="stat-dot"></div><span>Updated live</span></div>
                </div>
                <div class="stat-card hospitals">
                    <div class="stat-ornament">+</div>
                    <div class="stat-label">Registered Hospitals</div>
                    <div class="stat-value" id="totalHospitals">0</div>
                    <div class="stat-meta"><div class="stat-dot"></div><span>Updated live</span></div>
                </div>
                <div class="stat-card requests">
                    <div class="stat-ornament">!</div>
                    <div class="stat-label">Active Requests</div>
                    <div class="stat-value" id="activeRequests">0</div>
                    <div class="stat-meta"><div class="stat-dot" style="background:var(--amber);"></div><span>Pending</span></div>
                </div>
                <div class="stat-card completed">
                    <div class="stat-ornament">âœ“</div>
                    <div class="stat-label">Completed Today</div>
                    <div class="stat-value" id="completedRequests">0</div>
                    <div class="stat-meta"><div class="stat-dot" style="background:var(--emerald-bright);animation:none;opacity:1;"></div><span>Fulfilled</span></div>
                </div>
            </div>

            <!-- Terminal Monitor -->
            <div class="content-section">
                <div class="section-header">
                    <div class="section-title">
                        <div class="section-eyebrow">System</div>
                        <h3>Live Request Monitor</h3>
                    </div>
                    <button class="btn-action" onclick="refreshTerminal()">
                        <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                </div>
                <div class="terminal-requests" id="terminalRequests">
                    <div class="terminal-topbar">
                        <div class="terminal-dots">
                            <div class="terminal-dot red"></div>
                            <div class="terminal-dot amber"></div>
                            <div class="terminal-dot green"></div>
                        </div>
                        <div class="terminal-topbar-title">lifelink â€” blood-request-monitor</div>
                        <span class="terminal-time" id="terminalTime"></span>
                    </div>
                    <div class="terminal-body">
                        <div id="terminalContent">
                            <div class="loading"><div class="spinner"></div><p>Initializing monitor...</p></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Donors Preview -->
            <div class="leaderboard-card">
                <div class="section-header">
                    <div class="section-title">
                        <div class="section-eyebrow">Recognition</div>
                        <h3>Top 5 Life Savers</h3>
                    </div>
                    <button class="btn-action" onclick="showSection('leaderboard')">
                        <i class="bi bi-trophy"></i> Full Leaderboard
                    </button>
                </div>
                <div id="topDonorsPreview">
                    <div class="loading"><div class="spinner"></div><p>Loading...</p></div>
                </div>
            </div>
        </div>

        <!-- â”€â”€ Blood Requests Section â”€â”€ -->
        <div id="requestsSection" class="content-section-wrapper" style="display:none;">
            <div class="page-header">
                <div class="page-header-eyebrow">Directory</div>
                <h2>Blood Requests</h2>
                <p>Complete history with donor notification priority</p>
            </div>
            <div class="content-section">
                <div class="section-header">
                    <div class="section-title">
                        <div class="section-eyebrow">All Records</div>
                        <h3>Request History &mdash; <span id="requestListCount">0</span> entries</h3>
                    </div>
                    <button class="btn-action" onclick="loadAllRequests()"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
                </div>
                <div class="search-bar">
                    <input type="text" class="search-input" id="requestSearch" placeholder="Search by hospital, blood type, or statusâ€¦">
                </div>
                <div id="requestsGrid"><div class="loading"><div class="spinner"></div><p>Loadingâ€¦</p></div></div>
            </div>
        </div>

        <!-- â”€â”€ Leaderboard Section â”€â”€ -->
        <div id="leaderboardSection" class="content-section-wrapper" style="display:none;">
            <div class="page-header">
                <div class="page-header-eyebrow">Recognition</div>
                <h2>Donors Leaderboard</h2>
                <p>Honoring those who save lives</p>
            </div>
            <div class="leaderboard-card">
                <div class="section-header">
                    <div class="section-title">
                        <div class="section-eyebrow">Hall of Fame</div>
                        <h3>All-Time Rankings</h3>
                    </div>
                    <button class="btn-action" onclick="refreshLeaderboard()"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
                </div>
                <div id="leaderboardList"><div class="loading"><div class="spinner"></div><p>Loadingâ€¦</p></div></div>
            </div>
        </div>

        <!-- â”€â”€ All Donors Section â”€â”€ -->
        <div id="donorsSection" class="content-section-wrapper" style="display:none;">
            <div class="page-header">
                <div class="page-header-eyebrow">Directory</div>
                <h2>All Registered Donors</h2>
                <p>Complete donor database</p>
            </div>
            <div class="content-section">
                <div class="section-header">
                    <div class="section-title">
                        <div class="section-eyebrow">Donor Registry</div>
                        <h3><span id="donorCount">0</span> donors on record</h3>
                    </div>
                    <button class="btn-action" onclick="loadAllDonors()"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
                </div>
                <div class="search-bar">
                    <input type="text" class="search-input" id="donorSearch" placeholder="Search by name, blood type, or locationâ€¦">
                </div>
                <div id="donorsGrid"><div class="loading"><div class="spinner"></div><p>Loadingâ€¦</p></div></div>
            </div>
        </div>

        <!-- â”€â”€ All Hospitals Section â”€â”€ -->
        <div id="hospitalsSection" class="content-section-wrapper" style="display:none;">
            <div class="page-header">
                <div class="page-header-eyebrow">Directory</div>
                <h2>All Registered Hospitals</h2>
                <p>Hospital network database</p>
            </div>
            <div class="content-section">
                <div class="section-header">
                    <div class="section-title">
                        <div class="section-eyebrow">Hospital Network</div>
                        <h3><span id="hospitalCount">0</span> hospitals registered</h3>
                    </div>
                    <button class="btn-action" onclick="loadAllHospitals()"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
                </div>
                <div class="search-bar">
                    <input type="text" class="search-input" id="hospitalSearch" placeholder="Search by name or locationâ€¦">
                </div>
                <div id="hospitalsGrid"><div class="loading"><div class="spinner"></div><p>Loadingâ€¦</p></div></div>
            </div>
        </div>

        <!-- â”€â”€ Analytics Section â”€â”€ -->
        <div id="analyticsSection" class="content-section-wrapper" style="display:none;">
            <div class="page-header">
                <div class="page-header-eyebrow">Insights</div>
                <h2>Analytics</h2>
                <p>System performance metrics</p>
            </div>
            <div class="content-section">
                <div class="section-header">
                    <div class="section-title">
                        <div class="section-eyebrow">Statistics</div>
                        <h3>System Overview</h3>
                    </div>
                </div>
                <table class="info-table">
                    <tbody>
                        <tr><td>Total Users</td><td><strong id="analyticsTotalUsers">0</strong></td></tr>
                        <tr><td>Total Donors</td><td><strong id="analyticsTotalDonors">0</strong></td></tr>
                        <tr><td>Total Hospitals</td><td><strong id="analyticsTotalHospitals">0</strong></td></tr>
                        <tr><td>Total Requests</td><td><strong id="analyticsTotalRequests">0</strong></td></tr>
                        <tr><td>Completed Requests</td><td><strong id="analyticsCompletedRequests">0</strong></td></tr>
                        <tr><td>Success Rate</td><td><strong id="analyticsSuccessRate">0%</strong></td></tr>
                        <tr><td>Active Requests</td><td><strong id="analyticsActiveRequests">0</strong></td></tr>
                        <tr><td>Critical Requests</td><td><strong id="analyticsCriticalRequests">0</strong></td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- â”€â”€ Settings Section â”€â”€ -->
        <div id="settingsSection" class="content-section-wrapper" style="display:none;">
            <div class="page-header">
                <div class="page-header-eyebrow">Configuration</div>
                <h2>Settings</h2>
                <p>System preferences</p>
            </div>
            <div class="content-section">
                <div class="section-header">
                    <div class="section-title">
                        <div class="section-eyebrow">General</div>
                        <h3>Configuration</h3>
                    </div>
                </div>
                <div class="settings-grid">
                    <div class="form-group">
                        <label>System Name</label>
                        <input type="text" class="form-control" value="LifeLink Nepal" readonly>
                    </div>
                    <div class="form-group">
                        <label>Admin Email</label>
                        <input type="email" class="form-control" value="{{ user.email|default:'admin@lifelink.com' }}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Emergency Contact</label>
                        <input type="tel" class="form-control" value="+977-1-4444444" readonly>
                    </div>
                    <div class="form-group">
                        <label>Refresh Interval</label>
                        <input type="text" class="form-control" value="10 seconds" readonly>
                    </div>
                </div>
            </div>
            <div class="content-section">
                <div class="section-header">
                    <div class="section-title">
                        <div class="section-eyebrow">Info</div>
                        <h3>System Information</h3>
                    </div>
                </div>
                <table class="info-table">
                    <tbody>
                        <tr><td>System Version</td><td>1.0.0 Beta</td></tr>
                        <tr><td>Last Updated</td><td>February 07, 2026</td></tr>
                        <tr><td>Database Status</td><td><span class="status-badge fulfilled">Online</span></td></tr>
                        <tr><td>Total Users</td><td><strong id="settingsTotalUsers">0</strong></td></tr>
                        <tr><td>API Status</td><td><span class="status-badge fulfilled">Operational</span></td></tr>
                        <tr><td>Live Monitoring</td><td><span class="status-badge fulfilled">Enabled</span></td></tr>
                        <tr><td>Server Location</td><td>Kathmandu, Nepal</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div><!-- /content-area -->
</div><!-- /admin-main -->

<script>
console.log('ğŸš€ LifeLink Dashboard Initializing...');

let allDonors    = [];
let allRequests  = [];
let allHospitals = [];
let previousCounts = { donors: 0, hospitals: 0, requests: 0, completed: 0 };

const API_URL          = window.location.origin;
const REFRESH_INTERVAL = 10000;

/* â”€â”€â”€ CSRF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        for (const cookie of document.cookie.split(';')) {
            const c = cookie.trim();
            if (c.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(c.slice(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
const csrftoken = getCookie('csrftoken');

/* â”€â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function makeApiRequest(url, options = {}) {
    const headers = { 'Content-Type': 'application/json', ...options.headers };
    if (options.method && options.method !== 'GET' && csrftoken) {
        headers['X-CSRFToken'] = csrftoken;
    }
    try {
        const response = await fetch(url, { ...options, headers, credentials: 'include' });
        if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        return await response.json();
    } catch (error) {
        console.error(`âŒ Failed: ${url}`, error);
        showToast(`API Error: ${error.message}`, 'error');
        return null;
    }
}

/* â”€â”€â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.querySelectorAll('.menu-item[data-section]').forEach(item => {
    item.addEventListener('click', function(e) {
        e.preventDefault();
        const section = this.dataset.section;
        showSection(section);
        document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
        this.classList.add('active');
    });
});

function showSection(section) {
    document.querySelectorAll('.content-section-wrapper').forEach(s => s.style.display = 'none');
    const map = {
        dashboard:   'dashboardSection',
        requests:    'requestsSection',
        leaderboard: 'leaderboardSection',
        donors:      'donorsSection',
        hospitals:   'hospitalsSection',
        analytics:   'analyticsSection',
        settings:    'settingsSection',
    };
    const el = document.getElementById(map[section]);
    if (el) {
        el.style.display = 'block';
        if (section === 'leaderboard') loadFullLeaderboard();
        if (section === 'donors')      loadAllDonors();
        if (section === 'hospitals')   loadAllHospitals();
        if (section === 'requests')    loadAllRequests();
        if (section === 'analytics')   loadAnalytics();
        if (section === 'settings')    loadSettings();
    }
    // sync sidebar active state
    document.querySelectorAll('.menu-item[data-section]').forEach(m => {
        m.classList.toggle('active', m.dataset.section === section);
    });
}

/* â”€â”€â”€ DASHBOARD STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadDashboardStats() {
    const donorsData = await makeApiRequest(`${API_URL}/api/donors/`);
    if (donorsData) {
        allDonors = Array.isArray(donorsData) ? donorsData : [];
        const count = allDonors.length;
        document.getElementById('totalDonors').textContent = count;
        if (count > previousCounts.donors && previousCounts.donors > 0)
            showToast(`${count - previousCounts.donors} new donor(s)!`, 'success');
        previousCounts.donors = count;
    }

    const hospitalsData = await makeApiRequest(`${API_URL}/api/hospitals/`);
    if (hospitalsData) {
        allHospitals = Array.isArray(hospitalsData) ? hospitalsData : [];
        document.getElementById('totalHospitals').textContent = allHospitals.length;
        previousCounts.hospitals = allHospitals.length;
    }

    const requestsData = await makeApiRequest(`${API_URL}/api/blood-requests/`);
    if (requestsData) {
        allRequests = Array.isArray(requestsData) ? requestsData : [];
        const active    = allRequests.filter(r => r.status === 'pending');
        const fulfilled = allRequests.filter(r => r.status === 'fulfilled');
        document.getElementById('activeRequests').textContent    = active.length;
        document.getElementById('completedRequests').textContent = fulfilled.length;
        document.getElementById('requestCount').textContent      = active.length;
        if (active.length > previousCounts.requests && previousCounts.requests > 0)
            showToast(`${active.length - previousCounts.requests} new request(s)!`, 'error');
        previousCounts.requests = active.length;
        await loadTerminalWithMatchedDonors();
    }

    loadTopDonorsPreview();
}

/* â”€â”€â”€ TERMINAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updateTerminalTime() {
    const el = document.getElementById('terminalTime');
    if (el) el.textContent = new Date().toLocaleTimeString('en-US', { hour12: false });
}

async function loadTerminalWithMatchedDonors() {
    const container = document.getElementById('terminalContent');
    if (!container) return;

    if (!allRequests.length) {
        container.innerHTML = `<div class="terminal-line"><span class="terminal-label">[SYSTEM]</span> <span class="terminal-success"> Operational â€” standing by</span></div>`;
        return;
    }

    const active = allRequests
        .filter(r => r.status === 'pending')
        .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
        .slice(0, 5);

    if (!active.length) {
        container.innerHTML = `<div class="terminal-line"><span class="terminal-label">[SYSTEM]</span> <span class="terminal-success"> All requests fulfilled</span></div>`;
        return;
    }

    let html = '';
    for (const req of active) {
        const urgencyClass   = req.urgency_level === 'critical' ? 'urgent' : '';
        const hospitalName   = req.hospital_name || 'Unknown Hospital';
        let matchedDonors    = [];
        const matchData      = await makeApiRequest(`${API_URL}/api/blood-requests/${req.id}/matched_donors/`);
        if (matchData?.matched_donors) matchedDonors = matchData.matched_donors;

        html += `<div class="terminal-request ${urgencyClass}">
            <div class="terminal-line"><span class="terminal-label">[REQ #${req.id}]</span> <span class="terminal-value"> ${new Date(req.created_at).toLocaleString()}</span></div>
            <div class="terminal-line"><span class="terminal-label">HOSPITAL :</span> <span class="terminal-value"> ${hospitalName}</span></div>
            <div class="terminal-line"><span class="terminal-label">BLOOD    :</span> <span class="terminal-value"> ${req.blood_type}</span><span class="terminal-label">  UNITS:</span><span class="terminal-value"> ${req.units_needed}</span></div>
            <div class="terminal-line"><span class="terminal-label">URGENCY  :</span> <span class="${req.urgency_level === 'critical' ? 'terminal-urgent' : 'terminal-value'}"> ${(req.urgency_level || 'NORMAL').toUpperCase()}</span></div>`;

        if (matchedDonors.length) {
            html += `<div class="matched-donors-section"><div class="terminal-line"><span class="terminal-label">[MATCHED]</span> <span class="terminal-success"> ${matchedDonors.length} compatible donors â€” priority order:</span></div>`;
            matchedDonors.slice(0, 10).forEach((match, i) => {
                const rank  = i + 1;
                const label = rank === 1 ? 'ğŸ¥‡ NOTIFYING NOW' : rank === 2 ? 'ğŸ¥ˆ NEXT IN LINE' : rank === 3 ? 'ğŸ¥‰ 3RD PRIORITY' : `   #${rank} IN QUEUE`;
                html += `<div class="donor-match-item">
                    <div class="terminal-line"><span class="terminal-label">${label}</span> <span class="terminal-value"> ${match.donor.full_name}</span></div>
                    <div class="terminal-line"><span class="terminal-label">  BLOOD:</span><span class="terminal-value"> ${match.donor.blood_type}</span><span class="terminal-label">  SCORE:</span><span class="terminal-success"> ${match.match_score}%</span><span class="terminal-label">  PHONE:</span><span class="terminal-value"> ${match.donor.phone || 'N/A'}</span></div>
                </div>`;
            });
            html += `</div>`;
        } else {
            html += `<div class="terminal-line"><span class="terminal-urgent">[NO MATCH]</span> <span class="terminal-value"> No compatible donors found</span></div>`;
        }
        html += `</div>`;
    }
    container.innerHTML = html;
}

/* â”€â”€â”€ DONORS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadAllDonors() {
    const container = document.getElementById('donorsGrid');
    if (!container) return;
    container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading...</p></div>';
    document.getElementById('donorCount').textContent = allDonors.length;
    if (!allDonors.length) { container.innerHTML = `<div class="empty-state"><i class="bi bi-people"></i><h4>No Donors Registered</h4></div>`; return; }
    displayDonors(allDonors);
}

function displayDonors(donors) {
    const container = document.getElementById('donorsGrid');
    if (!container) return;
    if (!donors.length) { container.innerHTML = `<div class="empty-state"><i class="bi bi-search"></i><h4>No donors found</h4></div>`; return; }
    container.innerHTML = `<div class="data-grid">${donors.map(d => `
        <div class="data-card">
            <div class="data-card-header">
                <div class="data-avatar">${(d.full_name || 'D')[0]}</div>
                <div class="data-info">
                    <h4>${d.full_name || 'Unknown'}</h4>
                    <p><i class="bi bi-droplet-fill"></i><span class="blood-type ${(d.blood_type||'').includes('-') ? 'negative' : 'positive'}">${d.blood_type || 'N/A'}</span></p>
                </div>
            </div>
            <div class="data-info">
                <p><i class="bi bi-geo-alt-fill"></i> ${d.location || d.address || 'Not provided'}</p>
                <p><i class="bi bi-telephone-fill"></i> ${d.phone || 'No phone'}</p>
                <p><i class="bi bi-envelope-fill"></i> ${d.email || 'No email'}</p>
                <p><i class="bi bi-calendar-fill"></i> ${d.created_at ? new Date(d.created_at).toLocaleDateString() : 'N/A'}</p>
            </div>
        </div>`).join('')}</div>`;
}

/* â”€â”€â”€ HOSPITALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadAllHospitals() {
    const container = document.getElementById('hospitalsGrid');
    if (!container) return;
    container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading...</p></div>';
    document.getElementById('hospitalCount').textContent = allHospitals.length;
    if (!allHospitals.length) { container.innerHTML = `<div class="empty-state"><i class="bi bi-hospital"></i><h4>No Hospitals Registered</h4></div>`; return; }
    displayHospitals(allHospitals);
}

function displayHospitals(hospitals) {
    const container = document.getElementById('hospitalsGrid');
    if (!container) return;
    if (!hospitals.length) { container.innerHTML = `<div class="empty-state"><i class="bi bi-search"></i><h4>No hospitals found</h4></div>`; return; }
    container.innerHTML = `<div class="data-grid">${hospitals.map(h => `
        <div class="data-card">
            <div class="data-card-header">
                <div class="data-avatar hospital"><i class="bi bi-hospital-fill"></i></div>
                <div class="data-info">
                    <h4>${h.name || h.hospital_name || 'Unknown Hospital'}</h4>
                    <p><span class="status-badge fulfilled">Active</span></p>
                </div>
            </div>
            <div class="data-info">
                <p><i class="bi bi-geo-alt-fill"></i> ${h.location || h.address || 'Not provided'}</p>
                <p><i class="bi bi-telephone-fill"></i> ${h.phone || 'No phone'}</p>
                <p><i class="bi bi-envelope-fill"></i> ${h.email || 'No email'}</p>
                <p><i class="bi bi-calendar-fill"></i> ${h.created_at ? new Date(h.created_at).toLocaleDateString() : 'N/A'}</p>
            </div>
        </div>`).join('')}</div>`;
}

/* â”€â”€â”€ REQUESTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadAllRequests() {
    const container = document.getElementById('requestsGrid');
    if (!container) return;
    container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading...</p></div>';
    document.getElementById('requestListCount').textContent = allRequests.length;
    if (!allRequests.length) { container.innerHTML = `<div class="empty-state"><i class="bi bi-inbox"></i><h4>No Blood Requests</h4></div>`; return; }
    displayRequests(allRequests);
}

async function displayRequests(requests) {
    const container = document.getElementById('requestsGrid');
    if (!container) return;
    if (!requests.length) { container.innerHTML = `<div class="empty-state"><i class="bi bi-search"></i><h4>No Requests Found</h4></div>`; return; }

    const sorted = [...requests].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
    let html = '';

    for (const req of sorted) {
        const hospitalName = req.hospital_name || 'Unknown Hospital';
        let matchedDonors  = [];
        const matchData    = await makeApiRequest(`${API_URL}/api/blood-requests/${req.id}/matched_donors/`);
        if (matchData?.matched_donors) matchedDonors = matchData.matched_donors;

        html += `<div class="request-card ${req.urgency_level === 'critical' ? 'critical' : ''}">
            <div class="request-header">
                <div class="request-id">REQUEST #${req.id}</div>
                <span class="status-badge ${req.status}">${(req.status || 'PENDING').toUpperCase()}</span>
            </div>
            <div class="request-body">
                <div class="request-field"><div class="request-label">Hospital</div><div class="request-value">${hospitalName}</div></div>
                <div class="request-field"><div class="request-label">Blood Type</div><div class="request-value"><span class="blood-type ${(req.blood_type||'').includes('-') ? 'negative' : 'positive'}">${req.blood_type || 'N/A'}</span></div></div>
                <div class="request-field"><div class="request-label">Units Needed</div><div class="request-value">${req.units_needed || 0} units</div></div>
                <div class="request-field"><div class="request-label">Urgency</div><div class="request-value" style="color:${req.urgency_level === 'critical' ? '#d97070' : 'inherit'}">${(req.urgency_level || 'NORMAL').toUpperCase()}</div></div>
                <div class="request-field"><div class="request-label">Created</div><div class="request-value">${req.created_at ? new Date(req.created_at).toLocaleString() : 'N/A'}</div></div>
                ${req.notes ? `<div class="request-field" style="grid-column:1/-1;"><div class="request-label">Notes</div><div class="request-value">${req.notes}</div></div>` : ''}
            </div>`;

        if (matchedDonors.length) {
            html += `<div class="donor-priority-list"><h5><i class="bi bi-people-fill"></i> Top 10 Matched Donors â€” Notification Priority</h5>`;
            matchedDonors.slice(0, 10).forEach((match, i) => {
                const rank        = i + 1;
                const rankClass   = rank <= 3 ? `rank-${rank}` : 'rank-other';
                const priClass    = rank === 1 ? 'priority-1' : rank === 2 ? 'priority-2' : rank === 3 ? 'priority-3' : 'priority-other';
                const notifyText  = rank === 1 ? '1st â€” notified first' : rank === 2 ? '2nd â€” if 1st declines' : rank === 3 ? '3rd â€” backup' : `${rank}th in queue`;
                html += `<div class="donor-priority-item">
                    <div class="donor-priority-info">
                        <div class="donor-priority-rank ${rankClass}">${rank}</div>
                        <div class="donor-priority-details">
                            <p>${match.donor.full_name || 'Unknown'} &mdash; ${match.donor.blood_type || 'N/A'}</p>
                            <p>${match.donor.phone || 'No phone'} &nbsp;Â·&nbsp; Score: ${match.match_score}%</p>
                        </div>
                    </div>
                    <span class="priority-badge ${priClass}">${notifyText}</span>
                </div>`;
            });
            html += `</div>`;
        }
        html += `</div>`;
    }
    container.innerHTML = html;
}

/* â”€â”€â”€ TOP DONORS PREVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadTopDonorsPreview() {
    const container = document.getElementById('topDonorsPreview');
    if (!container) return;
    const top5 = allDonors.filter(d => d.donation_count > 0).sort((a, b) => b.donation_count - a.donation_count).slice(0, 5);
    if (!top5.length) {
        container.innerHTML = `<div class="empty-state" style="padding:40px;"><i class="bi bi-trophy" style="font-size:40px;opacity:0.15;display:block;margin-bottom:12px;"></i><h4>No donations yet</h4><p>Leaderboard will populate as donors complete donations</p></div>`;
        return;
    }
    container.innerHTML = top5.map((d, i) => {
        const rank      = i + 1;
        const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : 'rank-other';
        const emoji     = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : rank;
        const stars     = Math.min(5, Math.ceil(d.donation_count / 2));
        return `<div class="leaderboard-item ${rankClass}">
            <div class="rank-badge ${rankClass}">${emoji}</div>
            <div class="donor-info-leaderboard">
                <div class="donor-avatar-leaderboard">${(d.full_name || 'D')[0]}</div>
                <div class="donor-details-leaderboard">
                    <h4>${d.full_name || 'Unknown'}</h4>
                    <p><i class="bi bi-droplet-fill"></i>&nbsp;<span class="blood-type ${(d.blood_type||'').includes('-') ? 'negative' : 'positive'}">${d.blood_type || 'N/A'}</span>&nbsp;&nbsp;<i class="bi bi-geo-alt-fill"></i>&nbsp;${d.location || d.address || 'Unknown'}</p>
                    <div class="donor-stars">${'<i class="bi bi-star-fill star"></i>'.repeat(stars)}</div>
                </div>
            </div>
            <div class="donation-count"><i class="bi bi-heart-fill"></i>${d.donation_count}</div>
        </div>`;
    }).join('');
}

/* â”€â”€â”€ FULL LEADERBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadFullLeaderboard() {
    const container = document.getElementById('leaderboardList');
    if (!container) return;
    container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading...</p></div>';
    const ranked = allDonors.filter(d => d.donation_count > 0).sort((a, b) => b.donation_count - a.donation_count);
    if (!ranked.length) { container.innerHTML = `<div class="empty-state"><i class="bi bi-trophy"></i><h4>No donations recorded</h4></div>`; return; }
    container.innerHTML = ranked.map((d, i) => {
        const rank      = i + 1;
        const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : 'rank-other';
        const emoji     = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : `#${rank}`;
        const stars     = Math.min(5, Math.ceil(d.donation_count / 2));
        return `<div class="leaderboard-item ${rankClass}">
            <div class="rank-badge ${rankClass}">${emoji}</div>
            <div class="donor-info-leaderboard">
                <div class="donor-avatar-leaderboard">${(d.full_name || 'D')[0]}</div>
                <div class="donor-details-leaderboard">
                    <h4>${d.full_name || 'Unknown'}</h4>
                    <p><i class="bi bi-droplet-fill"></i>&nbsp;<span class="blood-type ${(d.blood_type||'').includes('-') ? 'negative' : 'positive'}">${d.blood_type || 'N/A'}</span></p>
                    <p><i class="bi bi-geo-alt-fill"></i>&nbsp;${d.location || d.address || 'Unknown'}&nbsp;&nbsp;<i class="bi bi-telephone-fill"></i>&nbsp;${d.phone || 'N/A'}</p>
                    <div class="donor-stars">${'<i class="bi bi-star-fill star"></i>'.repeat(stars)}</div>
                </div>
            </div>
            <div class="donation-count"><i class="bi bi-heart-fill"></i>${d.donation_count}</div>
        </div>`;
    }).join('');
}

function refreshLeaderboard() { loadDashboardStats().then(loadFullLeaderboard); }

/* â”€â”€â”€ ANALYTICS / SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function loadAnalytics() {
    const completed = allRequests.filter(r => r.status === 'fulfilled').length;
    const active    = allRequests.filter(r => r.status === 'pending').length;
    const critical  = allRequests.filter(r => r.urgency_level === 'critical' && r.status === 'pending').length;
    const rate      = allRequests.length > 0 ? Math.round((completed / allRequests.length) * 100) : 0;
    document.getElementById('analyticsTotalUsers').textContent       = allDonors.length + allHospitals.length;
    document.getElementById('analyticsTotalDonors').textContent      = allDonors.length;
    document.getElementById('analyticsTotalHospitals').textContent   = allHospitals.length;
    document.getElementById('analyticsTotalRequests').textContent    = allRequests.length;
    document.getElementById('analyticsCompletedRequests').textContent= completed;
    document.getElementById('analyticsSuccessRate').textContent      = rate + '%';
    document.getElementById('analyticsActiveRequests').textContent   = active;
    document.getElementById('analyticsCriticalRequests').textContent = critical;
}

function loadSettings() {
    document.getElementById('settingsTotalUsers').textContent = allDonors.length + allHospitals.length;
}

/* â”€â”€â”€ SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.addEventListener('DOMContentLoaded', function () {
    document.getElementById('donorSearch')?.addEventListener('input', e => {
        const t = e.target.value.toLowerCase();
        displayDonors(allDonors.filter(d =>
            (d.full_name||'').toLowerCase().includes(t) ||
            (d.blood_type||'').toLowerCase().includes(t) ||
            (d.address||d.location||'').toLowerCase().includes(t)
        ));
    });

    document.getElementById('hospitalSearch')?.addEventListener('input', e => {
        const t = e.target.value.toLowerCase();
        displayHospitals(allHospitals.filter(h =>
            (h.hospital_name||h.name||'').toLowerCase().includes(t) ||
            (h.address||h.location||'').toLowerCase().includes(t)
        ));
    });

    document.getElementById('requestSearch')?.addEventListener('input', e => {
        const t = e.target.value.toLowerCase();
        displayRequests(allRequests.filter(r =>
            (r.hospital_name||'').toLowerCase().includes(t) ||
            (r.blood_type||'').toLowerCase().includes(t) ||
            (r.status||'').toLowerCase().includes(t)
        ));
    });
});

/* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showToast(message, type = 'info') {
    const colors = { success: '#2a8c6e', error: '#c23b3b', warning: '#b87333', info: '#2a6bac' };
    const toast  = document.createElement('div');
    toast.style.cssText = `position:fixed;top:20px;right:24px;background:${colors[type]};color:#fff;padding:12px 20px;border-radius:6px;box-shadow:0 8px 24px rgba(0,0,0,0.3);z-index:10001;font-size:13px;font-weight:600;letter-spacing:0.2px;animation:slideInRight 0.25s ease;font-family:var(--font-body)`;
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => {
        toast.style.opacity    = '0';
        toast.style.transition = 'opacity 0.25s';
        setTimeout(() => toast.remove(), 250);
    }, 3000);
}

function refreshTerminal() { loadDashboardStats(); }

/* â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const styleEl = document.createElement('style');
styleEl.textContent = `@keyframes slideInRight{from{transform:translateX(300px);opacity:0}to{transform:translateX(0);opacity:1}}`;
document.head.appendChild(styleEl);

setInterval(updateTerminalTime, 1000);
updateTerminalTime();

document.addEventListener('DOMContentLoaded', function () {
    loadDashboardStats();
    setInterval(loadDashboardStats, REFRESH_INTERVAL);
});
</script>
{% endblock %}